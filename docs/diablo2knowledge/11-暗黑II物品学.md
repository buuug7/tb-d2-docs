# 暗黑 II 物品学

import TOCInline from '@theme/TOCInline';

<TOCInline toc={toc} />

## 前言

本文主要是整合了 anhei3 战网 Wind_Force 的《物品学教程》、贴吧漠然轻寒的《暗黑物品掉落原理》（入门篇、深入篇、实例篇）和 IMPK1.13 版论坛资料索引中相关资料的内容，也加入了历年来收集的各种资料作为补充。

整合物品学资料的目的是想理清对暗黑物品体系的理解，也方便有需要的咸鱼堡(471418989)群友参考。整合过程中，我发现仍然低估了暗黑整个物品体系的复杂程度，完成全文后反复检查了多次，能力所限，估计还是有很多疏漏和错误，如果你有更多的资料或者不同的看法欢迎与我联系（16855047）。

文章转载获得了 Wind_Force 的授权，漠然轻寒大大和 IMPK 战网的留言一直未回复。所以要转载使用于其他用途的，自己和原作者们联系。

顺便说一下发群里的其他资料，信息数据来源因为系长期网络搜集下载而来，大都无法确定具体的出处，现将能明晰的来源列出：

- 暗黑破坏神吧资料集合
- anhei3 战网资料
- 仨 X 不等于四的百度经验
- 贴吧 open0595 的装备汇总贴
- 贴吧漠然轻寒等大佬历年发表的信息数据
- 91D2 战网资料
- IMPK1.13 版战网资料索引

## 物品学基础

### 物品的分类

看起来，暗黑 2 中的物品缤纷复杂，从劣质的皮甲（Low Quality Leather Armor）到泰瑞尔之力（Unique Scared Armor Tyreal’s Might），从微量生命药剂（Minior Health Potion）到符文萨德（Zod），如果再算上各种变化无穷的蓝色物品和金黄色物品，恐怕要数以万计。这么多的物品，并非是随意出现的，它们有着严格的分类和统筹关系。

#### 按物品种类分类

物品（Item）：

武器（Weapon）：各种可以用来拿在手上攻击的东西，如剑（Sword），弓（Bow），棍棒（Club），法杖（Staff）等等。

防具（Armor）：其中包括有各种头盔（Helm），甲（Armor），腰带（Belt）等等可以用来提升自己防御，保护自己的物品。

杂类（Misc）：这是一个很大的分类，向下又有数个详细的分类：

药剂（Potion）：各种生命药剂，魔法药剂，解毒药剂，瓦斯药剂等等。

卷轴（Scroll）：包括城镇传送卷轴（Town Portal Scroll）和辩识卷轴（Identify Scroll）.

书（Book）：书，可以用来存放卷轴，有两种，分别对应两种卷轴，每本书可以存放 20 个卷轴。

弹药（Bullet）：有箭矢（Arrow）和十字弓弹（Bolt）。

戒指（Ring）：戒指具有魔法的力量，每个角色可以佩带两枚。

项链（Amulet）：项链同样具有魔法的力量，每个角色只能佩带一枚。

宝石（Gem）：宝石可以镶嵌在有孔的武器或防具上，从而提升某方面的能力，分为红宝石（Ruby），蓝宝石（Sapphire），黄玉（Topaz），绿宝石（Emerald），紫宝石（Amethyst），钻石（Diamond），骷髅（Skull）。

珠宝（Jewel）：珠宝同样可以镶嵌在有孔的武器和防具上，和宝石不同的是，宝石镶嵌在不同的物品上会有不同的效果，而珠宝镶嵌在不同物品上的效果不会改变。

符文（Rune）：如果单独的，无序的去镶嵌符文，那它们的效果和宝石类似；但如果按照特定的顺序镶嵌在特定的物品上，就会形成一种被称为符文之语（Rune Words）的物品，这是一种强大的，效果远远超过符文本身效果的物品。符文总共有 33 种。

护符（Charm）：具有魔法力量的护身符，放在物品栏里就可以了。分为小型护符（Small Charm），大型护符（Large Charm）和超大型护符（Grand Charm）三种。

钥匙（Key）：用来开启上锁的箱子（Locked Chest）。

金钱（Gold）：地上满地都是的，可以用来买东西或者赌博。

耳朵（Ear）：并没有任何作用，只是用来纪念，每杀死一个敌对角色后（PVP），就可以获得该角色名字的耳朵。

任务物品（Quest Item）：做任务用的物品，比如维特之脚(Whit’s Leg)，赫拉迪瑞姆之杖（Horadirm’s Staff）等。一些任务的奖励，如技能之书(Book of Skill)等也属于此类。

在武器/防具下面，又分为若干个抽象的类别，比如武器的天球（Orb），短剑（Short Sword），短战斗弓（Short War Bow），防具中的帽子（Cup），硬皮甲（Hard Leather Armor），锁链手套（Chain Glove）等。这些抽象类别决定了该物品的外观和基本特性，比如黄金之肤（Gold Skin）和坦克雷的脊柱（Tancred’s Spine）都是全罩铠（Full Field Mail），所以它们的外观是一样的；而在 Craft 公式（手工物品合成）Nef + Perfect Ruby + Heavy Glove + Any Jewel = Blood Glove 中，使用重手套（Heavy Glove），鲨皮手套（Sharkskin Glove），吸血鬼骸骨手套（Vampirebone Glove）来作为原料，效果都是一样的，因为它们同属于重手套（Heavy Glove）类。

每个抽象类都被实体化为三个等级的具体物品，等级从低到高依次是普通级（Normal），扩展级（Exceptional），精英级（Elite）。随着等级的提升，物品的稀有程度提高，而且基础属性（如武器的攻击和防具的防御）也会大幅度提升。下面举例说明几种物品的等级。

[巨战之剑]

普通级：巨战之剑（War Sword）

扩展级：古代之剑（Ancient Sword）

精英级：秘仪之剑（Mythical Sword）

[皮甲]

皮甲（Leather Armor）

海蛇皮甲（Serpentskin Armor）

古龙皮（Wyrmhide）

[皇冠盾]

皇冠盾（Crown Shield）

皇家盾（Royal Shield）

旋风盾（Vortex Shield）

在这里，有一个抽象类是特殊的，就是头饰（Circlet）。头饰没有普通——扩展——精英的等级之分，只实体化为 4 种，按照其魔法等级的高低依次为头饰(Circlet)，宝冠（Coronet），三重冠(Tiara)和权冠（Diadem）。这里所谓的魔法等级将在后面介绍。

戒指和项链虽然也是穿戴的装备，但它们不存在抽象类，且不分三级。但分别有三种不同的外观，不同的外观对戒指和项链的属性无关。

#### 按物品品质（成色）分类

##### 暗金物品(Unique Items)

暗金物品是游戏中出现几率最低的。

暗金物品是独一无二的。每个暗金物品都有自己独特的名称、形状和颜色。

暗金物品同样分为普通、扩展和精华三种类型。不过有的物品类型没有对应的暗金形态。

暗金物品不会天然附带凹槽(本身带有凹槽属性的物品除外)。你可以借助第五幕第一个任务来给它打出一个凹槽来，固定 1 孔。

暗金物品无法用来做符文之语(Rune Word)。

暗金物品上可能会出现一些特殊属性。

同一场游戏中，同一件暗金物品只能掉落一次。

##### 绿色套装(Set Items)

当一套绿色套装集齐并装备之后，它们将产生额外的魔法效果。套装物品的名字呈绿色显示。鉴定过之后，每件套装物品的属性中都会列出该套装备的所有组件。如果缺少某件物品的话，它的名称将呈红色显示。

套装物品不会出现无形形态。

当装备了全套或者其中的几件套装物品时，其中的某些物品会获得额外的属性奖励。这些奖励属性呈绿色显示。

当装备了全套或者其中的几件套装物品时，还会获得一些整体的额外属性奖励。这些奖励属性呈暗金色显示。

套装物品同样分为普通、扩展和精华三种类型。不过有的物品类型没有对应的绿色形态。

套装物品不会天然附带凹槽(本身带有凹槽属性的物品除外)。你可以借助第五幕第一个任务来给它打出一个凹槽来，固定 1 孔。

套装物品无法用来做符文之语(Rune Word)。

套装物品上可能会出现一些特殊属性。

##### 亮金物品(Rare Items)

又称作杰出物品、稀有物品等。亮金物品在游戏中呈黄金色显示。

亮金物品的名称和属性没有关系，属于随机产生。

亮金物品可以拥有 3-6 个词缀，最多三个前缀和三个后缀(珠宝除外)。3-6 缀出现的几率为：1/8，2/8，3/8，2/8。

亮金珠宝可以拥有 3-4 个词缀，依然最多三个前缀或者三个后缀。3 和 4 缀出现的几率各为 1/2。

亮金物品所带的所有词缀的需求等级同基础物品的需求等级之间取最大值，便是该物品的最终需求等级。

亮金物品不会天然附带凹槽，但它可以通过工匠系词缀来获得凹槽。你可以借助第五幕第一个任务来给它打出一个凹槽来，固定 1 孔。

亮金物品无法用来做符文之语(Rune Word)。

##### 橙色手工艺品(Crafted Items)

手工艺品和亮金物品类似，但它们不能通过赌博、怪物掉落、以及开箱子等途径得到。唯一可以获得它们的办法是通过合成公式合成。它们在游戏中呈橙色显示。

手工艺品的命名规则同亮金物品。

每个手工艺品都会固定带有 3-4 种属性，变量随机。

每个手工艺品都会获得 1-4 个词缀，具体的词缀数量同物品等级 Ilvl 有关。同样，最多出现三个前缀或者三个后缀。

Ilvl = 1-30，有 40%几率获得 1 个词缀，而获得 2、3、4 个词缀的几率都为 20%

Ilvl = 31-50，有 60%几率获得 2 个词缀，而获得 3、4 个词缀的几率都为 20%

Ilvl = 51-70，有 80%几率获得 3 个词缀，而获得 4 个词缀的概率为 20%

Ilvl = 71-99，有 100%几率获得 4 个词缀

手工艺品的物品等级 Ilvl 的确定公式：Ilvl=[0.5\*原物品 Ilvl]+[0.5\*人物级别]，括号内计算数值分别向下取整，也就是说手工物品最高物品等级为 98。

手工艺品的需求等级确定：

1. 其所带所有词缀的需求级别中，取最大者 Max_ReqLvl

2. Max_ReqLvl 同基础物品的需求级别相比较，取较大者，记为 ReqLvl。

3. 最终需求等级=ReqLvl+3\*词缀数目+10

手工艺品的词缀选择同亮金物品。

手工艺品不会天然附带凹槽，可通过词缀获得。你可以借助第五幕第一个任务来给它打出一个凹槽来，固定 1 孔。

手工艺品无法用来做符文之语(Rune Word)。

手工艺品不会出现无形形态。

##### 魔法物品(Magic Items)

魔法物品在游戏中呈蓝色显示。

魔法物品可以获得 1-2 个词缀，最多一前缀一后缀。

只有一个前缀的几率为 25%

只有一个后缀的几率为 50%

同时获得前缀和后缀的几率为 25%

魔法物品由其所拥有的词缀名称来命名。

魔法物品所带的所有词缀的需求等级同基础物品的需求等级之间取最大值，便是该物品的最终需求等级。

魔法物品不会天然附带凹槽，可通过词缀获得。你可以借助第五幕第一个任务来给它打孔，1-2 孔随机。

魔法物品无法用来做符文之语(Rune Word)。

##### 超强物品(Superior Items)

只有武器(Weapons)和防具(Armors)才拥有超强形态。

超强的武器可以获得以下属性中的一个或两个：

5%-15%增强伤害

10%-15%增加耐久度

加 1-3 攻击准确率

超强的防具可以获得以下属性中的一个或两个：

5%-15%增强防御

10%-15%增加耐久度

如果武器的基础伤害过低，增强伤害属性在最终伤害计算取整之后不能使其增加伤害的话，则转为“+1 最大伤害值”。

带有增强防御属性的防具，其基础防御值固定为最大值+1

超强物品有 1/3 的机会出现天然孔数，孔数随机

超强物品无法用公式打孔。可以借助第五幕第一个任务来给它打孔，固定最大孔数。

超强物品可以用来做符文之语。

##### 普通物品(Normal Items)

普通物品是 D2 物品系统的基础。

普通物品有 1/3 的机会出现天然孔数，孔数随机

普通物品可以用公式打孔，孔数随机。

普通物品可以用来做符文之语。

##### 劣质物品(Low Quality Items)

劣质物品具体分为劣质的、破碎的、损坏的、粗糙的四种，四类劣质物品除了名称外并无任何区别。

记普通物品的耐久度为 DUR，则对应劣质物品的耐久度=`{DUR/3}-1`

记普通武器的伤害为 DAM，则对应劣质武器的伤害=[DAM\*3/4]

记普通防具的防御值为 DEF，则对应劣质防具的防御值=[DEF\*3/4]

劣质物品不会天然出现凹槽，也不可以用公式打孔。但可以借助任务打孔，固定最大孔数。

劣质物品可以做符文之语。

##### 符文之语（RuneWord）

当按照一定的顺序，将正确的符文放入符合要求的凹槽物品后，就会得到很多附加属性，物品也会获得特殊名称，并变为暗金色，拥有强大的力量。这就是 "符文之语"（RuneWord）。

材料的孔数必须符合公式的要求。例如制作橡树之心需要 4 孔连枷，那么用 5 孔的连枷就无法做出来。

材料的类型必须符合公式的要求。例如眼光要求法杖类或者长柄武器类，那么你用长矛类就不可以。

符文之语只能作用在非魔法类型的凹槽物品上。这意味着绿色套装，暗金物品，或者魔法物品即使有足够的凹槽也无法使用符文之语。再次强调，符文之语不能作用在魔法，套装，暗金或亮金物品。 例如，符文大师有 5 个凹槽，但它是无法做战争召唤的。

按照公式使用正确的符文。如果一个符文插错就无法出现符文之语效果。

符文必须按正确的顺序放置。你必须有正确的物品类型，正确的符文和正确的镶嵌顺序。例如精神盾的正确顺序是 `7# 10# 9# 11#`，任何两个符文顺序放反都会变成“镶上宝石的统治者大盾”。

制作符文之语前请确认你的游戏版本。不同的版本有不同的符文之语，1.11 版本游戏可以做包括 1.09 跟 1.10 版本的所有符文之语，但 1.09 版本的游戏不支持 1.10 和 1.11 的符文之语。

符文之语无法作用于维特之脚。

### 装备的品质

物品和装备是两个不同的概念，物品是一个抽象的分类，比如说九头蛇弓（Hydra Bow），是指这样一个抽象类；而说我拣到一把九头蛇弓，则是一件实实在在存在于我手中的装备。

每件装备都有其自身的品质，品质越高，它的属性就越好，但其稀有程度也就越高。装备的品质分为以下几类：劣质的(Low Quality)，普通的（Normal），超强的（Superior），魔法的（Magical），稀有的（Rare），成套的（Set），独有的（Unique）；也就是常说的白色/蓝色/亮金/绿色/暗金装备。其中除了成套物品和独有物品具有固定的名字和属性类型以外，其余的物品大多数具有不同的名字和属性类型。

每一类物品都有劣质的/普通的/超强的/魔法的/稀有的装备相对应，因为这 5 类物品不具有固定的属性和名字；但并不是每类物品都有对应的成套/独有装备。比如秘仪之剑（Mythical Sword），我们可以在游戏中打到很多相同或不同蓝色的/白色的/亮金的秘仪之剑，或是一把绿色的秘仪之剑（BulKatho’s Tribla Guardian），但绝对不会打到暗金的秘仪之剑，因为这样的装备在游戏中是不存在的。个别物品也对应多个暗金/绿色装备，比如重靴（Heavy Boot）对应了山德的碎石（Sander’s Riprap）和牛魔王之蹄（Cowking’s Hooves）这两件装备；又如幻化之刃（Phase Blade）也对应了光之军刀（Light Saber）和碧蓝怒火（AzureWarth）两件装备。对于每件装备，其对应的物品叫做该装备的基础物品（底材）。

如果要提高获得高品质装备的几率，就需要提高角色的 MF（Magic Find）值，也就是装备上出现的（xx% Chance to Get Magic Items）。

### 物品和装备的品质等级（Quality Level）

每种物品都有自己的品质等级（下简称 qlvl），qlvl 不会随着物品是从哪个怪物身上掉落而改变。

装备也有品质等级（为了方便区分，将装备的品质等级缩写为 Qlvl），白色/蓝色/黄金装备的 Qlvl 和基础物品（底材）的 qlvl 是一样的，比如一件黄金的灰暮寿衣（Rare Dusk Shroud），它的 Qlvl 就和灰暮寿衣的 qlvl 是一样的为 64 级，所以对于白蓝黄装来说，一般不会单独讨论他们的 Qlvl，都是以底材的 qlvl 统一代替了。而对于成套的/独有的物品（即暗金和绿色套装），它们的 Qlvl 并不一定和其基础物品（底材）的 qlvl 相同。比如物品炎魔皮（Balrog Skin）是 qlvl 为 76 级的物品，而其对应的暗金装备阿凯恩的荣耀（Arkaine’s Valor）的 Qlvl 是 85 级。

### 物品的财宝阶层（Treasure Class，简称为 TC）

暗黑中的物品为了划分和在生成时计算，建立了财宝阶层（以下简称为 TC）这样的系统。TC 是对于武器，防具和符文而言的。武器和防具的 TC 分为 3、6、9、12、、、87，共 29 个 TC，每个 TC 包含了 3 个 qlvl，每个 TC 包括有 6-8 件物品。比如 TC 66 就包括 qlvl 64，65，66，TC66 包含了如下一些物品：

华丽铠甲（Ornate Plate）

灰暮寿衣（Dusk Shroud）

女族长标枪（Matriarchal Javelin）

银刃斧（Silver Edges Axe）

符文有自己独自的 TC，一般记作 RTC，从一号符文 El 开始，每相邻两号符文构成一个 RTC，这样 33 个符文，构成了 1-17，一共 17 个 TC，其中 33 号 Zod 独自构成 RTC17。

### 装备的物品等级（Item Level，简称 ilvl）

每件装备的物品等级（以下简称 ilvl）都可能不一样，装备的 ilvl 取决于掉落它的怪物的等级（Monster Level，简称 mlvl），一般来说，ilvl 等于掉该装备怪物的 mlvl。比如一把女族长弓（Matriarchal Bow），如果是地狱的 Baal 掉落的，由于 Baal 的等级是 99，则该女族长弓的 ilvl 为 99；而如果该女族长弓是地狱的地狱之牛（Hell Bovine）掉落的，那么它的 ilvl 就和地狱之牛的 mlvl 一样，为 81。

物品的 ilvl 在做手工（Craft）时特别有用，同时对于魔法物品和稀有物品的词缀选择也起到决定作用，这一点在后面将详细介绍。

### 装备的需求等级（Require Level，简称 reqlvl）

装备的需求等级（Require Level，简称 reqlvl）。我们拿到一件装备时，很多都会写有“需求等级 xx”，这就是 reqlvl，这规定了使用者的等级，避免低等级角色使用过强的装备而破坏游戏的平衡。

## 怪物与物品学的相关知识

### 怪物的分类

游戏中的怪物有很多很多，这里我们把怪物分为 4 类：

**BOSS**：包括每一幕的关底 BOSS 和普通 BOSS。关底 BOSS 有 5 个，安达利尔（Andariel），督瑞尔（Duriel），墨菲斯托（Mephisto），暗黑破坏神（Diablo），巴尔（Baal），关底 BOSS 的等级和属性固定。普通 BOSS 有 6 个，血乌（Bloodraven），格里斯瓦尔德（Griswold），罗达门特（Radament），召唤者（The Summoner），衣卒尔（Izual），尼拉塞克（Nihlathak），其等级固定，具有固定属性和部分随机属性。

**Super Unique/Random Uniques**：暗金怪，分固定暗金怪和随机暗金怪。固定暗金怪在固定场景出现，有固定属性和随机属性。随机暗金怪随机出现，名字由词缀“XXX 之 XXX 的”的随机构成，并根据这些词缀随机获得一些特殊属性。

**Minion**：仆从，是由 Unique 怪物带领的，带有部分领头 Unique 怪物的属性。

**Champion**：头目，比普通怪物要强，它们通常通过名字前面的前缀来获得一些额外的力量，从外观上分别，它们的名字显示是蓝色的。

**Normal**：普通怪物，大量的普通怪物才充实了暗黑的世界。

### 怪物等级（mlvl）与场景等级（简称 alvl）的关系

怪物的 mlvl 是多少，它就能掉落 ilvl 多少的装备。而怪物的 mlvl，大多数情况下取决于它所在场景的场景等级。在普通难度下，mlvl 是取决于怪物种类的，每个种类的怪物等级也是固定的，这是因为普通难度每个地图出现的怪物种类是固定的，在此基础上，Champion 怪物 mlvl 加 2，Minion/Unique 怪物 mlvl 加 3；在恶梦和地狱难度下，普通怪物的 mlvl 和所在场景的 alvl 相同，Champion 怪物 mlvl=alvl+2，Minion/Unique 怪物 mlvl=alvl+3。而 Boss 都有它们固有的等级，不由场景决定。

【腐败污秽者】及其同类型的怪物是整个暗黑怪物中的唯一特例。其不管是作为小怪还是头目还是精英怪，其怪物等级都不会受场景等级的修正而永远保持自身的等级不变（头目、暗金、随从还是会在原有等级上+2 或者+3）。因此，不管它出现在哪里，其等级都是固定的，具体等级如下：

普通 噩梦 地狱

腐败污秽者(putrid defiler)35 61 80

卑劣污秽者(wretched defiler)37 62 81

臭气污秽者(fetid defiler) 38 63 82

恶臭污秽者(rancid defiler)39 64 83

下贱污秽者(rank defiler)40 64 84

产生这一现象的原因是在 Monstats.txt 中，腐败污秽者系列 5 种怪物的代码 BOSS 一项被设置为=1。于是这一系列的怪物成了整个游戏中唯一被当做 BOSS 看待的小怪。由于其在代码中错误地被设置为了 BOSS，所以其等级不受场景等级的约束……个人猜测这或许是暴雪在设置游戏代码时的失误。

### 怪物的财宝阶层

每个怪物也有自己的 TC，怪物的 TC 决定了它能掉落什么样的物品。每个怪物掉落装备必须同时满足两个条件：

A.怪物 TC≥ 基础物品 TC，因为怪物的 TC 值代表了怪物能掉落的物品底材的最高 qlvl，物品底材的 qlvl 是体现在物品 TC 中，所以平时一般把这条检定条件写为：怪物 TC≥ 装备的底材 qlvl。

B.怪物 mlvl≥ 装备 Qlvl，要注意之前提到的暗金和绿装的 Qlvl 不一定与其底材 qlvl 一致，所以这也解释了为什么某些怪物不能掉落全部暗金或绿装。

例如：

青色愤怒，底材幻化之刃，底材 qlvl=73，成品 Qlvl=87

墨菲斯托，TC=78 ≥qlvl73，mlvl=87 ≥Qlvl87

因此墨菲斯托可以掉落青色愤怒

暴躁外皮 TC=87 ≥qlvl73 ,mlvl=86 \<Qlvl87

因此暴躁外皮可掉落幻化之刃底材但不能掉落青色愤怒。因为物品 ilvl 等于怪物的 mlvl，所以你看到掉落的低于 87 级的暗金幻化，你就能直接判断其为光之军刀了。

风之力-九头蛇弓，底材 qlvl=85，成品 Qlvl=80

墨菲斯托，TC=78 \<qlvl85

因此墨菲斯托不能掉落任何成色的九头蛇弓。

暴躁外皮 TC=87 ≥qlvl85 ,Mlvl=86 ≥Qlvl80

因此暴躁外皮可掉落风之力。

## 装备的生成和品质检定

### 怪物掉落装备的过程

暗黑的装备一般有几个来源，怪物掉落，商店 NPC 购买，翻箱子（架子）和赌博。本节先讨论怪物掉落的过程。

#### NoDrop 检定

每个怪物被杀死后，系统首先检测是否有物品掉落，即是否为“No Drop”。如果系统选定了 No Drop，那么这个怪物就什么也不会掉落。No Drop 被检定的几率降低，那么掉落物品的机会就高，这也是为什么多人游戏中怪物掉落物品比较多的原因，这点将在后面详细讲解。

#### 确定物品类型

当系统检定该怪物会掉落物品，即非“No Drop”后，下面将决定掉落的物品类型，也就是将生成什么样的物品，是药剂，或是武器等。对于物品种类的检定，有一些规则：

\# Random Unique 最少会掉落一件物品，且最低品质为 Magical，或是宝石或符文。

\# Super Unique 总是固定掉落 4 瓶药剂和 2 件装备，且 2 件装备的最低品质为 Magical，除非这两件是宝石或符文。

\# 每个怪物最多可以掉落 6 件物品，但游戏中很少有怪物可以掉落这么多，即使是 BOSS 级怪物也不一定每次都能 Full Drop（满掉落，即掉落了 6 件物品）。有些情况下，杀死怪物后会出现多于 6 件物品，但这仅仅限于里面的若干件物品是 Gold 的情况下，几件 Gold 在物品生成时是计算为 1 件的。同样的，各种卷轴也是计算为一件物品。

#### TC 检定

物品的 TC 检定过程。怪物的 TC 决定了怪物能掉落什么样的物品，系统从怪物的 TC 开始依次向下检测，比如对于地狱难度的 Mephisto，它的 TC 是 78，那么系统首先检测 TC 为 78 的所有物品，如果 TC 为 78 的物品没有被选中，那么就检测 TC 为 75 的物品，如果依然没有被选中，就继续向下类推，直到某个 TC 中的某件物品被选中，那么这个怪物死后，就会掉落此 TC 内的物品。

#### 确定底材

物品的类型检定过程。当某一个 TC 被选中后，那么系统就开始在这个 TC 中检定究竟有什么物品会产生，即所产生装备的基础物品（底材）是什么。在这里，也存在一些针对特殊物品的规则：

\# 死灵的手杖类，法师的双手法杖类，圣骑士的权杖类，这三类物品被检定的几率只有普通物品的 1/3。

\# 刺客的爪（包括爪，腕刃，格斗剪等所有刺客专用的武器）被检定的几率只有普通物品的 2/3。

\# 其他角色专用物品，法师专用法珠，圣骑士的专用盾牌，德鲁依专用头盔，野蛮人专用头盔，死灵专用盾，亚马逊专用弓，亚马逊专用矛，亚马逊专用标枪等，被检定的几率只有普通物品的 1/3。

#### 决定物品品质

物品的品质决定过程。这个过程是你的 MF 值，怪物类型/等级，所检定基础物品（底材）的 qlvl 等共同决定的。系统会从最难被检测的 Unique 品质开始检测，按照 Unique\>Set\>Rare\>Magical\>Superior\>Normal\>Low Quality 的顺序依次向下检测，如果上一级品质检测失败，则会转向下一品质继续检测，直到某一品质检测成功为止。

这里有几点注意的：

\# 如果某物品被检测为 Unique 品质，但是该物品不存在对应的 Unique 形态的装备，或是该怪物的 mlvl 小于该装备的 Qlvl，那么最终将生成一件耐久（Durability）为正常 3 倍的 Rare 物品。比如：Mythical Sword。

\# 如果某物品被检测为 Set 品质，但是该物品不存在对应的 Set 形态的装备，或是该怪物的 mlvl 小于该装备的 Qlvl，那么最终将生成一件耐久为正常 2 倍的 Magical 物品，比如 Archon Plate。

上面我们讨论的是武器和防具的品质决定，下面我们来研究一下戒指和项链的产生。

项链和戒指不存在 TC 的概念，因为它们的基础物品：戒指和项链的 qlvl 都是 1，这里要引入一个新的概念：稀有度（Rarity）。Unique 和 Set 的戒指/项链，主要就是靠稀有度和 Qlvl 来决定的。

首先，Qlvl 的重要性我们已经知道了，Unique/Set 的戒指和项链也有它们各自的 Qlvl，怪物不可能掉落 Qlvl 比自己 mlvl 高的 Unique/Set 戒指或项链。而相对稀有度的概念则比较抽象，我们不妨举个例子：比如我杀死了一个 mlvl 为 10 的怪物，掉落了一个 Unique 戒指，毫无疑问，它一定是拿格，因为这个怪物的 mlvl 还不以掉落玛那得的治疗。而如果该怪物的 mlvl 为 20，那这时候就要靠稀有度来判断其掉落情况了，我没有查阅具体资料，比方拿格的稀有度为 10，玛那得的治疗稀有度为 5，那么，由于 Qlvl 低于 20 的 Unique 戒指只有这两个，那么这个 Unique 戒指被检定为拿格的概率为 10/（10+5）=2/3，而被检定为玛那得的治疗的概率就有 5/（10+5）=1/3。

#### 确定附加属性

决定物品是否有插槽（Socket），以及装备是否为无形（Ethereal）等。

这样，在全部的六步骤结束后，一件装备就诞生了。

### TC 的详细介绍

实际的 TC 系统并不像之前简单介绍的那样只是一个数字等级系统，TC 是怪物能够掉落物品类型的一个集合或者看作一个目录。TC 系统将物品按珍贵程度分类。所有的 TC 共同组成 TC 系统。游戏用 TC 系统来决定每个怪物能掉什么物品。注意，每一个子 TC 可能连接不止一个父 TC。

每个怪物各对应一个 TC，怪物死的瞬间，将从该 TC 内按照设定好的几率随机选取某几个类型的物品掉落；若随机到了 NoDrop，则不掉物品。

#### TC 的组成

每一个单独的子 TC 目录都记录有如下的信息：

Treasure Class：这一项定义该 TC 的名称。命名规则为"Act "+act_number+" "+difficulty_code{"","(N)","(H)"}+" TC_Type "+area_code{"A","B","C"}。比如，地狱难度下 act3 的怪物可能有以下几个 TC：Act 3 (H) H2H A, Act 3 (H) Cast B, Act 3 (H) Miss C, etc.

Group：这一项定义该 TC 所在的组别

Level：这一项定义了该 TC 的等级，treasureclasses level。这是暗黑 2 代码中对一个组中的 TC 进行的分级。从 0\~85，间隔不固定。无组别（Group 项为空）的 TC 无此等级。

Picks：这一项数据的绝对值代表了该 TC 选取物品的数目。Picks 数的正负实际上是对 Prob1-10 项作用的规定。当 Picks 数为正数时，则在该 TC 中有放回地按照各自的概率抽取物品，抽取次数等于 Picks 数值。当 Picks 数为负数时，则规定了物品的数量，等于 Picks 的绝对值。

Unique，Set，Rare，Magic：四项分别代表了暗金，绿色，亮金，蓝色判定的【修正参数】。修正后掉落几率值=修正前掉落几率值\*（1-修正参数/1024）。

当某一个成色的修正参数 ≥1024 时，则成色判定到此结束。也就是说该 TC 只能掉落当前成色品质或更好的成色品质。比如设置 Magic=1024，那么如果物品判定为暗金、绿色、黄色则与此无关。如果物品没有被判定为暗金、绿色、亮金，则 100%被判定为蓝色。

例如：墨菲斯托的修正参数为 Unique=800，Set=800，Rare=900，Magic=1024

则其掉落暗金的判定几率修正为约 4.57 倍，绿色的判定几率修正为约 4.57 倍，绿色的判定几率修正为约 8.26 倍，蓝色的判定几率修正为正无穷大倍。即最低判定蓝色（成色判定到蓝色为止，不掉落蓝色以下装备）。此处详细计算参考后文装备成色判定内容。

NoDrop：此处定义了该 TC 不掉任何物品的几率

Item1-10：这 10 列定义了该 TC 可掉落的各种物品（也可以填入一个子 TC）

Prob1-10：当 PICKS 数为正数时，这一栏的数字代表了对应 Item1-10 中的物品的掉落几率。当 PICK 数为负数时，这一栏的数字代表了对应 Item1-10 中的物品取出的实际数量。

一般来说，当 PICKS 为负数时，Prob1+ Prob2+…Prob10=PICKS 数绝对值。

但当 Prob1\~Prob10 之和大于 PICKS 数绝对值时，游戏仍只会掉出 PICKS 数绝对值个物品，按照 Prob1\~Prob10 的顺序和数量选取物品，到达 PICKS 数绝对值则停止。也就是说最多只会掉落 PICKS 数绝对值个物品而不会超过 PICKS 数绝对值。

而当 Prob1\~Prob10 之和小于 PICKS 数绝对值时，游戏取完 Prob1\~Prob10 的物品数量后则选取结束。也就是说最终只会掉落 Prob1+ Prob2+…Prob10 的物品数而达不到 PICKS 数绝对值。

当然，无论在任何情况下，一个怪物掉出 6 个物品则立刻停止掉落，这是由游戏的硬代码所规定的。

#### 物品在 TC 中的归类存放

##### 自动 TC 匹配系统

每个 TC 中都会详细地列出其中所包含的物品装备，但自动 TC 除外。自动 TC 匹配系统允许 TC 只记录一个数字，游戏会根据这个数字自动找到匹配的 qlvl 的所有底材。

自动 TC 从 3 到 87，每次加 3，共有 29 个自动 TC 等阶。每个自动 TC 等阶包含了其之下 3 个等级的 qlvl。例如“自动 TC 等阶 87”包含了 85\~87 这 3 个 qlvl 的所有底材。

底材 qlvl 设定：游戏会从 Weapons.txt 中 Level 列读取武器底材的 qlvl，从 Armor.txt 中同一位置读取防具底材的 qlvl，从 Misc.txt 中同一位置读取饰品底材的 qlvl

注意：饰品（项链、戒指）的底材 qlvl=1 固定不变（任务物品蝮蛇项链这里不讨论）

游戏中允许使用自动 TC 匹配系统的物品类型在 ItemTypes.txt 中被确定。其中 TreasureClass 一项=1 则表示允许使用自动 TC 匹配。实际游戏中有 5 类物品允许使用自动 TC 匹配，分别是：弓（bow），武器（weap），近战武器（mele），防具（armo），亚马逊专用弓（abow），简单说就是游戏中所有的【武器】和【防具】能使用自动 TC 匹配系统。其中的几个子武器类别是用于修正近战和远程武器在不同怪物中的掉落几率而设（例如有些弓箭手怪物的 TC 中包含了自动 TC“bow+数字”，于是其掉落弓的几率相对大一些）

之前我们提到的 TC 为 XX 数字，这个 XX 数字就是该怪物 TC 中的自动 TC 等阶的最高等阶值。我们在日常交流和地图插件中显示的都是这个值。

比如地狱难度墨菲斯托的 TC 中的自动 TC 最高为“weap78”和“armo78”，因此我们简称墨菲斯托 TC=78。

##### TC 自动升高

我们知道，普通怪物的级别是按照一定规则随场景等级调整的。而随着 mlvl 调整它的 TC 也会随级别进行自动升高调整。具体步骤如下：

A 获取怪物的初始 TC

B 查 TC 列表，得到该 TC 的 Group 值

C 选择与该 TC 同一 Group、并且满足 TC level≤mlvl 的 level 最大的 TC 作为该怪物的实际 TC

比如噩梦难度的古难记录者。查怪物和场景等级知毁灭王座为 66 场景，古难级别为 66+3=69，噩梦难度对应的 TC 为 Act 5 (N) Champ C。查 TC 列表得 Act 5 (N) Champ C 对应的 Group13 中，级别小于等于 69 的 TC，level 最大的是 Act 2 (H) Champ A。即噩梦难度古难记录者的实际 TC 为 Act 2 (H) Champ A。

这里有两个特例。牛的 TC 是 Cow (H)，这个 TC group 和 TC level 的值都为空值，也就是只有这一个 TC；议会成员的 TC 为 Council (H)，该 TC 的 TC group 和 TC level 的值也都为空值。因此，这两类怪物的 TC 不会随场景等级提升。

所以我们在游戏中 83 场景的小怪和 85 场景的小怪虽然都简称 TC=87，这是由于两者的 TC 中的自动 TC 的最高等阶都是 87，因此两者都有可能掉落 Qlvl=85\~87 的最高级的底材。但两者的 TC 是完全不同的两个 TC，因此掉落同一底材的几率完全不同。

##### 其他杂物的存放

杂物在 TC 中分为 3 大类，分别是金币（Gold）、货物（Good）和废物（Junk）

货物（Good）中包含有：珠宝饰品（Jewelry）、宝石（Gem）、符文（Runes）

\-珠宝饰品（Jewelry）中包含有：戒指、项链、珠宝、护符

废物（Junk）中包含有：药水（Potion）、杂物（Misc）、弹药（Ammo）

\-药水（Potion）中包含有：各种生命药剂、魔法药剂、活力药剂、溶解药剂、解毒药剂、耐力药剂

\-杂物（Misc）中包含有：钥匙、回城卷轴、鉴定卷轴、各种投掷类药剂

\-弹药（Ammo）中包含有：箭矢、十字弓弹

这些子 TC 也像所有 TC 一样，以 PICKS 代表了抽取装备的数量，Item 和 Prob 标示出物品和几率。

符文 TC 共有 17 个，每个 TC 包含 2 个符文以及嵌套入上一等级的符文 TC，第 1 级符文 TC 只包含 1\#和 2\#，第 17 级符文 TC 只包含 33\#和上一级 TC。

例如：【Runes 1】这个 TC 包含了 1\#和 2\#

【Runes 2】这个 TC 包含 3\#、4\#以及子 TC【Runes 1】

【Runes 17】这个 TC 包含了 33\#和子 TC【Runes 16】

##### TC 嵌套系统以及对怪物掉落的修正

一个 TC 的 Item 项不仅能填入一个物品代码，还能填入一个 TC 名称。因此一个 TC 中可能包含另一个 TC，就像一本书的目录中的大标题下可以包含小标题一样。这就是 TC 嵌套系统。

上文中的符文 TC 就是通过 TC 嵌套系统使得当前符文 TC 可以掉落之前的符文 TC 包含的所有符文。

TC 嵌套系统最大的作用就是对怪物的掉落物品类型作出修正。比如在一个近战怪的总掉落 TC 下嵌套进一个近战武器的自动 TC 并设定概率，这就能提高这个怪物掉落近战武器的概率。又比如，在一个怪物的 TC 中分别嵌套进装备和药水 2 个子 TC，并设定好数量，就能让怪物每次都掉落固定数量的装备和药水。

要使得怪物掉落金币，除了在其 TC 中嵌套入金币子 TC 外，还可以直接填入"gld,mul=2048"之类的值以使得 BOSS 怪掉落更多的金币。

例如：女伯爵的总掉落 TC 中嵌套有女伯爵物品子 TC 和女伯爵符文子 TC 这 2 个子 TC。然后在女伯爵物品子 TC 中嵌套有其能掉的金币、装备、杂物（包括符文），在女伯爵符文子 TC 中嵌套有另一个符文 TC。于是女伯爵这个怪物的符文爆率就会高于一般怪，并且只对一定范围的符文提高爆率。

### 基础物品（底材）掉落过程

1）对于非 BOSS 怪，首先在 Monstats.txt 中得到怪物的初始 TC 名称（如果是固定精英怪则在 SuperUniques.txt 中得到其初始 TC）。

2）在 TreasureClassEx.txt 中找到该初始 TC 名称所在的 TC 组，并对其 TC 等级（treasureclasses level）进行判定是否执行 TC 升高（group=0 的怪跳过这一过程直接进入 4.）。

3）然后，根据 TC 升高原理在初始 TC 所在的 TC 组中进行 TC 升高得到其最终 TC。

4）在 TreasureClassEx.txt 中找到该怪物的最终 TC（BOSS 和一些特殊怪的 TC 直接以其名字命名），确定 PICKS 数为正数还是负数

5）若 Picks 数为正数，则每个子 TC 的判定概率= 其对应 Prob 值/（Nodrop 值+ 所有 Prob 值之和）

5.1）若选择的结果是 NoDrop, 则此次选择结束。若总选择次数小于 Picks 值，重复步骤 5 继续下一次选择。

注意：此处的 Nodrop 几率会被游戏人数修正，具体修正规则如下：

在多人游戏里,先要进行人数记数,方法如下:杀死怪物者记 1,与杀怪者结盟并在同一场景的人,每人记 1,其余的人每人记 0.5。

将这些数相加,总和要向下取整数。设记数的结果为 p,则修正后的 Nodrop 几率为初始 Nodrop 几率的 p 次方。（注意这里使用的是 Nodrop 几率而不是 Nodrop 值）。

单机游戏中调整 pp 数，虚拟出来的人数是不算做你的盟友的。

5.2）若选择的结果是金币, 就掉一些金币, 此次选择结束。若总选择次数小于 Picks 值，重复步骤 5 继续下一次选择。

金币在 TC 列表中的表示方法为"gld,mul=1280"，其中 1280 为举例，可为其他数字。

金币的基础掉落数值为：mlvl \~ (6\*mlvl-1)，随机选择。其中 mlvl 为掉落金币的怪物等级。

确定基础数值后，乘以倍数：mul/256

5.3）若本次 Picks 的掉落 TC 最终被判定为一个自动 TC（即本次掉落物品被判定为一件武器或防具），那么就由 ItemTypes.txt 中读取匹配该自动 TC 等阶的所有底材的所属物品种类（如剑、长柄、弓等）的稀有度（Rarity）。按照稀有度确定其被选择的几率。

注意： A.底材的抽取按照稀有度确定各自的概率，而不是很多人理解的该 TC 内所有物品被选择的几率相同

B.这里使用的是底材所属【物品种类】的稀有度，而不是底材本身的稀有度。例如：在 TC“bow63”中阴影弓被抽取的概率取决于【弓类武器】的稀有度而不取决于【阴影弓】的稀有度。

至于武器、防具底材自身的稀有度是用于武器架、防具架的掉落，杂物底材的稀有度理论上没有任何实际用途。

在该自动 TC 等阶中随机选取一件物品底材掉落，每个物品底材被选取的几率= 该底材所属物品种类的稀有度/ 该自动 TC 等阶中所有底材物品种类的稀有度之和

一般物品种类的稀有度为 3

圣骑士【权杖】、女巫【双手法杖】、死灵法师【手杖】以及【女巫专用法珠】、【死灵法师专用盾】、【圣骑士专用盾】、【野蛮人专用头盔】、【德鲁伊专用头盔】、【亚马逊专用弓】、【亚马逊专用矛】、【亚马逊专用标枪】稀有度为 1

【刺客专用爪】稀有度为 2

选中某一具体物品后，进入成色判断步骤，后文有详细介绍。

5.4）若选择的结果是某个子 TC, 就进入那个子 TC 重复上面的步骤。

5.5）若总选择次数小于 Picks 值，重复步骤 5 继续下一次选择。

5.6）全部选择结束，若掉落物品大于六件，则取前六件。

6）若 PICKS 数为负数，则每个子 TC 按照其 Prob 值中的数量掉落，掉完所有 Prob 值为止，但不超过总 PICKS 绝对值

7）一旦实际掉落物品达到 6 个则立刻停止掉落判定。

可见，底材的掉落判定是一个递归调用过程。

注意这个过程选择的是物品类型，完全随机选择，这就是我们俗称的 RP，跟 MF 数值没有丝毫关系。确定是否掉落符文也是在这个过程完成的。因此，掉落符文的几率跟 MF 值毫无关系。

### 装备成色的判断过程

选定了掉出某物品后，要进行物品成色的判断，即判断是掉暗金(Unique)的，还是绿色套装(Set)的，还是亮金(Rare)的，还是蓝色(Magical)的，亦或是其它的。其中,暗金，绿色，亮金和蓝色的选择成功率受杀死怪物者的 MF 值影响。物品成色的判断顺序为: 暗金，绿色，亮金，蓝色，其它，即先判断是否暗金，若失败，再判断是否绿色，依次类推，能否判断成功，依赖于以下过程:

#### Chance1 = (Value - [(Mlvl - Qlvl)/Divisor]) \* 128

从 ItemRatio.txt 中按照当前底材情况读取成色判定参数，即公式中的 Value 和 Divisor 值，暗金绿装亮金蓝色物品的值均不同。

Value 和 Divisor 如下:

非角色专用物品

=========================================

成色 Unique Set Rare Magical Superior Normal

\-------------------------------------------------------------

Value 400 160 100 34 12 2(1 for Uber)

Divisor 1 2 2 3 8 2(1 for Uber)

=========================================

角色专用物品

=========================================

成色 Unique Set Rare Magical Superior Normal

\------------------------------------------------------------

Value 240 120 80 17 9 2(1 for Uber)

Divisor 3 3 3 6 8 2(1 for Uber)

=========================================

其中，Uber 指的是扩展级和精华级的物品。

从 ItemRatio.txt 中读取参数分为 6 种情况，分别是 1.非资料片普通级底材 2.非资料片扩展级底材 3.资料片普通级底材 4.资料片扩展精华级底材 5.普通级职业专属底材 6.扩展精华级职业专属底材。

根据相应情况读取数据可得到 4 组成色判定参数（Unique、UniqueDivisor、UniqueMin） （Rare、RareDivisor、RareMin） （Set、SetDivisor、SetMin） （Magic、MagicDivisor、MagicMin），即为上面提到的该底材判定为暗金、绿色、黄色、蓝色的 Value 和 Divisor。Min 值是指判定为该品质的最小几率，后面的计算会用到。

#### 计算 UF, SF, RF, MF

UF: Unique Find, 暗金的几率修饰

SF: Set Find, 绿色的几率修饰

RF: Rare Find, 亮金的几率修饰

MF: Magical Find,蓝色的几率修饰

mf: 装备上的 mf 值的总和.

若 mf\<=10, 则 UF=SF=RF=MF=mf

否则:

UF = mf\*250/(mf + 250)

SF = mf\*500/(mf + 500)

RF = mf\*600/(mf + 600)

MF = mf

而 SupF=NF≡0，即 MF 不影响超强(Superior)和普通(Normal)的判断。

#### Chance2 = Chance1 \* 100 / (100 + XF)

XF 即为上面的 UF, SF, RF, MF, SupF, NF

#### 与 Min 值的比较

将 Chance2 数值同 1 中提到的 Min 值对比。如果 Chance2\<Min，则 Chance2=Min

Min 值列表如下

==========================

成色 Unique Set Rare Magical

\---------------------------------------

Min 6400 5600 3200 192

==========================

超强(Superior)和普通(Normal)成色的物品没有对应的 Min 值。

#### Chance = Chance2 - [(Chance2 \* cx)/1024]

其中, cx 指 cu, cs, cr, cm;

cu: Chance of Unique， 暗金几率参数；

cs: Chance of Set， 绿色几率参数；

cr: Chance of Rare， 亮金几率参数；

cm: Chance of Magical，蓝色几率参数。

超强跟普通成色的几率参数为 0。换句话说，它们没有几率参数。

这一步可以看作是怪物 TC 对成色判定的修正，cx 值就是上文提到怪物 TC 文件中 Unique、Rare、Set、Magic 四项修正参数的值。

一般来说，常见怪物的各参数可列表如下：

============================

怪物名 cu cs cr cm

\------------------------------------------

普通怪物及仆从 0 0 0 0

蓝色怪物&五小队头目 800 800 800 1024

随机金怪 800 800 800 1024

大部分固定金怪 800 800 972 1024

关底 Boss 983 983 983 1024

暴躁外皮&剥壳凹槽 512 654 972 1024

安达利尔任务杀 995 995 1024 1024

其他 Boss 任务杀 993 993 1024 1024

召唤者 900 900 972 1024

罗达门特 900 900 900 1024

议会成员 650 800 800 1024

铁匠&格瑞斯华尔得 0 0 0 0

海法斯特盔甲制造者 800 800 900 1024

尼拉塞克 900 900 900 1024

女伯爵 883 883 983 1024

母牛之王 850 983 983 1024

#### 最终决定

若 Chance=0，则判断成功。

若 Chance\>0，游戏随机取一个小于 Chance 的整数. 如果此数小于 128, 则判断成功。

#### 强制成色限制

ItemTypes.txt 中对物品类型的成色的作出了限制：

戒指、项链不存在蓝色以下形态（Magic=1，Rare=1，Normal=0）

护符只存在蓝色（Magic=1，Rare=0，Normal=0）、暗金（这个在 UniqueItems.txt 中被设定）形态。

所有杂物都不存在成色判定（Magic=0，Rare=0，Normal=1）,如金币、药水、弹药、符文等。

#### 暗金、绿色最终形态的确定以及降格判定

暗金或者绿色物品判断成功后，判断是否存在，若不存在，则发生降格。若存在，比较对应物品的 Qlvl 是否大于怪物级别，大于的话同样发生降格。

同一个游戏中，同一件暗金物品只能掉落一次，如果同一物品在同一场游戏里出现第二次判定，同样降格为亮金物品。

暗金物品降格为对应的亮金物品，同时耐久度\*3。

绿色物品降格为对应的蓝色物品，同时耐久度\*2。

当满足怪物 mlvl 的暗金、绿色物品有多个时，根据其成品稀有度（该数据从 UniqueItems.txt 和 SetItems.txt 的 Rarity 列得到）来确定各自的概率（Rarity /总 Rarity），从中随机抽取一个。

例如，地狱巴尔出了一件【神圣盔甲】，并且成功地被判定为了暗金色。首先判定 mlvl 是否大于 Qlvl，由于地狱巴尔的 mlvl 同时满足【泰瑞尔的力量】和【圣堂武士的力量】的成品 Qlvl，因此两者都有可能掉落。然后判定具体掉落种类，泰瑞尔的力量稀有度为 1，圣堂武士的力量稀有度为 8，因此这件暗金的神圣盔甲被判定为泰瑞尔的力量的概率是 1 /（1+8）≈11.1%

注意：这里使用的是物品的暗金/绿色形态的稀有度，而不是物品底材的稀有度。（上文已经说过，物品底材的稀有度和怪物掉落物品的几率基本没有关系）

总结：怪物的 mlvl 越高/物品的 qlvl 越低/玩家的 mf 值越高, 出现好成色的几率越高。

部分不存在暗金和绿色形态的物品，BUG 杀 BOSS 的时候，可能 MF 越高，亮金的几率越小，蓝色几率越大，此种现象对于非资版尤其明显。

### 白色物品判定

当暗金-绿色-黄色-蓝色成色判定全部失败后，物品被确定为白色物品。这时开始判定物品的品质，按照超强的-普通的之顺序依次判定。

与颜色判定类似地，先从 ItemRatio.txt 中读取资料片游戏的品质判定参数：

|                        | HiQuality Value | HiQuality Divisor | Nomal Value | Nomal Divisor |
| ---------------------- | --------------- | ----------------- | ----------- | ------------- |
| 普通级通用物品         | 12              | 8                 | 2           | 2             |
| 扩展精英级通用物品     | 12              | 8                 | 1           | 1             |
| 普通级角色专属物品     | 9               | 8                 | 2           | 2             |
| 扩展精英级角色专属物品 | 9               | 8                 | 1           | 1             |

计算公式和颜色判定相同，但不受任何外在影响修正（超强/普通的判定不受 MF 值影响）

Chance=1/（1 +(Value–(mLvl-qLvl)/ Divisor)）

若该白色物品判定为超强的（High Quality）和普通的（Normal）都失败了，那么该物品被判定为劣质的（Low Quality）。

## 装备附加的属性

### 装备附加孔数的判定

白色物品中，所有的超强（High Quality）和普通（Normal）品质的物品有 1/3 的机会产生凹槽，凹槽数量=1\~凹槽最大值。

装备上的孔数首先和基础物品的种类有关，不同种类的物品都有一个最大孔数（Max Socket Number，简称为 MSN），比如一面白色的统治者大盾，他的 MSN 是 4，那么无论是怪物掉落的时候就具备插槽，或者是你通过 Lazurk 的任务打的孔，它的孔数都不会超过 4。

其次，装备上的孔数还受到装备品质的影响。Low Quality/Magical/Rare/Set/Unique，这 5 类物品不会随机带有插槽。（Magical 和 Rare 物品这里暂不讨论词缀的情况，Unique 物品也暂不讨论固有凹槽的属性）。

最后，物品上的孔数还受到 ilvl 的影响，ilvl 在这里分为 3 个区间，即[1-24]，[25-39]，[40-99]，ilvl 每达到下一个区间，这一个抽象类的 MSN 就会提高（这里的抽象类范围很大，比如 Helm 就包含了所有的除 Circlet，德鲁依专用皮毛，野蛮人专用头盔以外的所有类型）。比如对于 Circlet 这一类，ilvl 为[1-24]这个区间时，其 MSN 只能是 1（虽然它本身 MSN 是 3，但你不可能获得比 1 更多的孔数），ilvl 为[25-39]这个区间时，其 MSN 可以为 2，只有当其 ilvl 大于等于 40 时，它才能具有 3 个孔。

这样该装备最终的 MSN 由以上三点共同决定，其三者中最小的为最终 MSN，而该装备最终的孔数则在 0\~最终 MSN 中随机选择。

蓝色和亮金装备在掉落时不会带有随机凹槽，但本身蓝色/亮金装备的有些魔法词缀可以使该装备带有凹槽：

技工的（Mechanist’s）

alvl：10

作用效果：1\~2 孔

可以出现在魔法和稀有装备上

工匠的（Artificer’s）

alvl：33

作用效果：3 孔

只可以出现在魔法装备上

珠宝匠的（Jeweler’s）

alvl：55

作用效果：4 孔

只可以出现在魔法装备上

绿色/暗金装备会通过固定的属性获得插槽。

这里顺便说一下关于对无孔的装备打孔。打孔有两个途径，一个是通过第五幕第一个任务的报酬，这里有一些规则：

白色装备：必为该装备的最大孔数

蓝色装备：1-2 孔随机

金黄/绿色/暗金：必为 1 孔

另一个途径是通过打孔公式，只针对白色普通无孔装备（超强和劣质的都不行），孔数从 1 到 6 孔完全随机选择，每个的概率都是 1/6，但是受装备本身最大孔数及 ilvl 的限制，最大只能为 MSN。如，白色统盾最高 4 孔，盒子打孔时，1-3 孔都是 1/6 的几率，4 孔有 1/2 的几率。

### 关于无形（Ethereal，简称 Eth）装备

#### 定义

Ethereal 是一种物品属性，它可以给武器类装备带来 50%的基础伤害加成，给防具类装备带来 50%的基础防御加成。因此，在计算 ED%时 Ethereal 的 50%加成是直接算在基础数值中的，而不是简单地与 ED%值相加。

Ethereal 的物品掉落时耐久（Durability）都是 max 的，但只有同类有形装备的 50%+1，且不能修复，即使是 Cube 公式也不起作用。

Ethereal 属性的装备力量、敏捷需求减 10。

Ethereal 属性的装备出售在商店中的交易价值为同类有形装备的 1/4。

#### 出现条件

任何已被确定的掉落物品都有 5%的可能成为 Ethereal 物品，但不包括下面几类物品

有永不磨损（Indestructible）属性的装备

所有的套装（Set Item）

商人贩售的物品

赌博时得到的物品

Cube 合成装备（不会合成出 Ethereal 属性，但如果是升级原装备，Ethereal 属性会保留）

低质量（Cracked, Crude, Damaged）的物品

灌注（Imbue，Act1 第 5 个任务的奖励）物品上（如果 Imbue Ethereal 装备，Ethereal 属性会保留）

所有不存在 Durability 的物品，如弩箭筒，包括 Crystal Sword 系列的 Exceptional 和 Elite 物品\*

一些特例：有 4 件 Unique 装备必定是 Ethreal 属性：Wraith Flight（死灵夜翔）, Ethereal Edge（永恒边缘）, Shadow Killer（影杀者），Ghostflame（鬼火焰）。

#### 注意事项

佣兵不会磨损 Ethereal 装备

铁魔（Iron Golem） 能够继承 Ethereal 属性（提升基础伤害/防御），召唤出来的傀儡是透明形态。

Ethereal 物品掉落时可以同回复耐久（Durability）/数量（Quantity）属性共存。

Ethereal 属性防具升级后 50%的额外防御加成会消失。这是指升级之后重新计算基础防御，但是无形的依然要在新计算的基础防御上增加 50%。

Ethereal 装备可以用于打孔，无形的防具用盒子公式打孔时，基础防御增加 50%。

### Rare/Magical 物品上的词缀选择

##### 物品属性及限制

1. 暗金物品

暗金物品有最多 12 条固定属性，属性值可能有波动。

2. 绿色物品

绿色物品有最多 9 条自身固定属性，属性值可能有波动。每多装备 1 件同属一套的绿色装备，最多增加 2 条固定套装属性。套装最多包含 6 件物品。

3. 亮金和蓝色物品

亮金和蓝色物品的属性是按照词缀（affix）来随机生成的，每条词缀最多包含 3 个固定属性，属性值可能在一定范围内波动。

蓝色物品最多拥有 1 个前缀和 1 个后缀，最少 1 条词缀。仅有一个后缀的几率为 50%，仅有一个前缀的几率为 25%, 既有前缀又有后缀的几率为 25% 。

亮金物品最多拥有 3 个前缀和 3 个后缀，最少 2 条词缀。

亮金珠宝上最多有 4 个词缀,仍然可以出现三个前缀或后缀的情况。

同组的词缀只能出现 1 次（MagicPrefix、MagicSuffix.txt 中 Group 值相同的词缀为同组）。

词缀分三种 Equip，Jewel，Charm，分别对应装备、珠宝、护身符。

##### 物品的【魔法等级】MagicLevel：

只有少数物品拥有魔法等级，这是物品底材对其能出现的词缀等级范围的修正属性。

各种底材的魔法等级如下：

头饰=3、宝冠=8、三重冠=13、权冠=18，女巫法珠、双手法杖=1，普通、扩展级手杖=1

##### 【物品最高词缀等级】Max_Affix Level（简称 Max_Alvl）：

这里指的是物品允许出现的最高词缀等级 Affix Level（简称 Alvl），其值确定方式如下：

设 ilvl 和 qlvl 两者中较大值为 K

若物品 MagicLevel≠0，则 Max_Alvl=K+MagicLevel

若物品 MagicLevel=0 且 K\< (99 - qlvl/2), 则 Max_Alvl = K- qlvl/2

否则 Max_Alvl = 2 \* K- 99

注意，Max_Alvl 若大于 99，则取 99

##### 随机词缀的生成过程

首先随机确定该物品词缀的数量，蓝色 1\~2，黄色 3\~6。然后进入每条词缀的选择，对于每条词缀：

a) 首先随机确定其是后缀还是前缀，前缀则进入 magicprefix.txt 的代码中选择，后缀则进入 magicsurfix.txt 的代码中选择

b) 检测游戏版本，version=1 是 d2c，version=100 是 d2x，version=0 是 1.07 以前版本

c) 检测物品成色，Spawnable=0 的词缀不能作用于蓝色和黄色物品上，Rare=0 的词缀不能作用于黄色物品上

d) 检测物品底材类型，根据底材类型确定能够选择的词缀范围

e) 检测物品等级，根据物品等级进一步确定能够选择的词缀范围（只有词缀等级 Alvl≤ 物品最高词缀等级 Max_Alvl≤ 词缀最大等级 maxlevel 时才能被选取）

注意：实际上暗黑 2 中并没有限制物品等级过高而无法选择某词缀。这个 maxlevel 是用于让高等级物品选择某词缀时能获得更好的变量而设的。也就是说，某些词缀在代码中按照变量范围被拆分为了几份，高等级的物品只能获得该词缀的高变量版本。

f) 所有的可选词缀按照 frequency 值计算其被选中的概率（概率=该词缀 frequency /所有待选词缀 frequency 之和，类似于稀有度的使用），再根据计算出的概率随机选出 1 条词缀

g) 检测 group 值，如果该词缀的 group 值已经出现过则返回 f)，重新选择

h) 本条词缀生成确定，返回 a)，生成下一条词缀

### Auto Mod 的选择

AutoMod 可以看做物品上追加的前缀和后缀。因为 AutoMod 属性是由 AutoMagic.txt 中的词缀组成的。

AutoMod 词缀的选择原理和蓝色/黄色物品词缀的选择原理完全一样，可以参考上文的介绍。（这就是为何游戏中不会出现又加 4R 又加 AR/ED 的圣骑士专用盾了，因为这两个词缀是同属于 304 组的词缀，不会出现在同一物品上。）

这里要注意区分 Auto Mod 和 Staff Mod，Auto Mod 是附加的某个词缀，而 Staff Mod 则是附加的某个技能。Staff Mod 将在下一节详细讲解。

具有 Automod 的装备及相应的词缀：

装备类型 词缀 Alvl 组 亮金 属性

\-------------------------------------------------------------------------------

Ama Bow Fletcher's 1 300 是 +1 bow skills

Ama Bow Bowyer's 40 300 是 +2 bow skills

Ama Bow Archer's 60 300 否 +3 bow skills

\-------------------------------------------------------------------------------

Ama Jav/SpeHarpoonist's1 302 是 +1 javelin/spear skills

Ama Jav/SpeSpearmaiden's40 302 是 +2 javelin/spear skills

Ama Jav/Spe Lancer's 60 302 否 +3 javelin/spear skills

\-------------------------------------------------------------------------------

Orb of the Jackal 1 303 是 +1-5 life

Orb of the Fox 11 303 是 +6-10 life

Orb of the Wolf 27 303 是 +11-20 life

Orb of the Tiger 43 303 是 +21-30 life

Orb of the Mammoth 59 303 是 +31-40 life

Orb of the Colossus 75 303 否 +41-60 life

Orb Lizard's 3 303 是 +1-5 mana

Orb Snake's 12 303 是 +5-10 mana

Orb Serpent's 23 303 是 +11-20 mana

Orb Drake's 34 303 是 +21-30 mana

Orb Dragon's 45 303 是 +31-40 mana

Orb Wyrm's 56 303 是 +41-60 mana

Orb Great Wyrm's 67 303 否 +61-80 mana

\-------------------------------------------------------------------------------

Pal Shield Shimmering 1 304 是 +5-10% all resist

Pal Shield Rainbow 18 304 是 +8-15% all resist

Pal Shield Scintillating 28 304 是 +16-30% all resist

Pal Shield Prismatic 39 304 是 +25-35% all resist

Pal Shield Chromatic 50 304 否 +35-45% all resist

Pal Shield Sharp 10 304 是 +15-30 AR, 10-20% ED

Pal Shield Fine 18 304 是 +31-60 AR, 21-30% ED

Pal Shield Warrior's 30 304 是 +61-80 AR, 31-40% ED

Pal Shield Soldier's 42 304 是 +81-100 AR, 41-50% ED

Pal Shield Knight's 50 304 是 +101-121 AR, 51-65% ED

\-------------------------------------------------------------------------------

Nec Shield of Blight 1 305 是 2-7 pd over 3 seconds

Nec Shield of Venom 15 305 是 5-14 pd over 3 seconds

Nec Shield of Pestilence 25 305 是 13-28 pd over 4 seconds

Nec Shield of Anthrax 33 305 否 25-50 pd over 4 seconds

===============================================================================

注释: "Ama Jav/Spe" 指 Amazon 专用标枪和长矛; "AR" 指 "attack rating";"ED" 指 "enhanced damage"; "pd" 指 "poison damage"

### Staff Mod 的选择

暗黑里常常得到带各种 `+1~3` 级单项技能的 normal item，这些附带于 normal item 上的 skill 我们就称为 Staff Mod。可以获得 Staff Mod 的物品如下：

法杖(wand) 加男巫技能

野蛮人头盔(bar helm) 加野蛮人技能

骑士权杖(scepter) 加圣骑士技能

女巫杖(staff, orb) 加女巫技能

德鲁依头盔(pelt) 加德鲁依技能

死灵盾牌(heads) 加死灵技能

刺客爪(katar) 加刺客技能

刺客的情况有些特殊，她的专用爪分属 h2h2/h2h（gamecode）类，

只有 h2h2 的爪能带 staffmod。这里是列表：

battle cestus 斗腰刀

feral claws 猛禽爪

greater claws 巨爪

greater talons 巨鹰爪

hand scythe 手镰

runic talons 符文爪

scissors quhab 格斗剪

scissors suwayyah 近身剪

war fist 战拳

wrist sword 腕剑

suwayyah 近身刃

##### staffmod 的选择过程

skillid：在 txt 里每种游戏技能都是用阿拉伯数字编号作为他们的 id，不同 char 的 id 是 6-280 中某一段,base_id 就是某 char 在 skills.txt 里开始那个 id，比如 pal 是 96-125，base_id=96。

那么现在就开始解释暗黑系统是怎么选择 skill 的：

首先，系统决定“出现几个 skill”，这是一个在 0-99 间随机选择的过程(注入成品的 x=x+iLvl)：x\>90 出现 3 种 skill；70\<x\<90 出现 2 种；30\<x\<70， 1 种；x\<30，0

然后，开始选择什么 skill 出现了。

首先和 ilvl 有关的参数将被决定：我们设为 a

1\<=ilvl\<=11: a=1

12\<=ilvl\<=18: a=2

19\<=ilvl\<=24: a=3

25\<=ilvl\<=36: a=4

37\<=ilvl\<=99: a=5\*注

注意：注入的 clvl+4ilvl 的奖励在决定 a 之前提供，且任何 itemsilvl\>25 就会变成 magic，不再具有做 runewords 的性质

然后系统会随机提供修饰几率：

20%机会+1,50%机会不变，20%机会-1，10%机会-2,得到 a'

如果是低品质材料，如破碎的，a 将在 4 封顶，这就是为什么破碎的几乎不出什么高 id 的 skill。

然后，就进入选择出现 skill 的最后步骤：

公式 final skillid=base_id+5\*a'-5+(0，1，2，3，4 随机)

得出的数字，比如 93—bonespirit。

注：非资料片模式的 a 值最大取 4.

〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓分割线〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓

以下用表格来简单说明下物品等级跟技能选择的关系。

在这之前，引入一个 Skill Group 的概念。

Base_id ≤ Skill_id ≤ Base_id+4 ：Skill Group=1

Base_id+5 ≤ Skill_id ≤ Base_id+9 ：Skill Group=2

Base_id+10 ≤ Skill_id ≤ Base_id+14：Skill Group=3

Base_id+15 ≤ Skill_id ≤ Base_id+19：Skill Group=4

Base_id+20 ≤ Skill_id ≤ Base_id+24：Skill Group=5

Base_id+25 ≤ Skill_id ≤ Base_id+29：Skill Group=6

┌────────┬─────────────────┐

│ │ Skill Group │

│ 物品等级 iLvl ├──┬──┬──┬──┬──┬──┤

│ │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │

├────────┼──┼──┼──┼──┼──┼──┤

│ iLvl ≤ 11│ 80%│ 20%│ -- │ -- │ -- │ -- │

├────────┼──┼──┼──┼──┼──┼──┤

│12 ≤ iLvl ≤ 18│ 30%│ 50%│ 20%│ -- │ -- │ -- │

├────────┼──┼──┼──┼──┼──┼──┤

│19 ≤ iLvl ≤ 24│ 10%│ 20%│ 50%│ 20%│ -- │ -- │

├────────┼──┼──┼──┼──┼──┼──┤

│25 ≤ iLvl ≤ 36│ -- │ 10%│ 20%│ 50%│ 20%│ -- │

├────────┼──┼──┼──┼──┼──┼──┤

│37 ≤ iLvl ≤ 99│ -- │ -- │ 10%│ 20%│ 50%│ 20%│

└────────┴──┴──┴──┴──┴──┴──┘

因此出现在同一物品上的技能其等阶相差不会超过 3 阶，很多理想中的技能组合是不可实现的：如 冰支配和热情(Warmth)不会出现在同一法珠上，召唤骷髅和衰老不会出现在同一手杖上，火焰震爆不会和雷光守卫、亡者守卫出现在同一刺客爪上。

##### 确定 skill 的等级

再一次进行 0-99 的随机选择，然后如果是注入的话，再加上（clvl+4）/2 的增量。

得出的就是决定+？的参数：

0\<x≤60 +1

61\<x≤90 +2

91\<x≤99 +3

可以看出+3 的概率是很小的。

然后再重复最开始的步骤以继续选择其它 skill

注意，可能大家会想到要是第 2 次选择又恰好选到 bs，会怎么样？事实上在游戏里我们并没看到类似情况，因为在最后的选择公式得出的结果如果也=93，系统会回到最开始重新进行选择(0,1,2,3,4 随机）这部分。选中了不能出现的技能也是如此。

每个技能都限制了其需求的物品类型，只有当人物装备了该技能的需求物品时才能释放该技能。例如只有装备近战武器时才能施展旋风 Whirlwind，只有装备了盾时才能施展圣盾 Holy Shield。

只有物品类型符合该技能的需求限制时，StaffMod 才会选择该物品。

StaffMod 对技能的选择最多会循环 6 次，如果选择到符合要求的技能则结束。如果前 5 次都随机到需求类型不符的技能时，第 6 次无论随机到什么技能都会结束选择，无论第 6 次选择的技能是否符合要求。（这也是为什么我们在游戏中能看到加圣盾的权杖的原因所在）

##### 商店物品的 staffmod 选择

在 npc 处购买到的 staff ilvl=clvl+5。但是在 normal 难度下有 ilvl 封顶这一规定：act1 12/act2 20/act3 28/ act4 36/act5 45

所以，normal act1: max id=3;act2: 4;act3: 5;act4: 5;act5: 6，id1-6 代表前表的 6 个技能分组。

举例说，也就是不管你用什么样，多少级的 char 去 shop，也不可能在 normal act1 看见属于 4/5/6id 组的 skill。

下面是不限难度限制的几率计算：

clvl 1-6: id1 80% id2 20%

clvl 7-13: id1 30% id2 50% id3 20%

clvl 14-19: id1 10% id2 20% id3 50% id4 20%

clvl 20-31: id2 10% id3 20% id4 50% id5 20%

clvl 32-99: id3 10% id4 20% id5 50% id6 20%

注意到 normal act2 最高 20ilvl，所以情况应同 14-19clvl，即： id1 10%/id2 20%/id3 50%/id4 20%

## 其他物品获得方式

### NPC 出售的物品

每当城内无人时, NPC 就会重置所出售的物品。新物品的生成只与重置后第一个与 NPC 交谈的人的等级有关。

1\. 确定 ilvl

出售的物品的 ilvl = Clvl + 5。Clvl 为人物的等级。若游戏难度为 Normal， 则 ilvl 有上限：

==================

Act Max ilvl

\------------------

1 12

2 20

3 28

4 36

5 45

==================

2\. 确定 qlvl

所出售的物品的 qlvl 不大于 ilvl。

3\. 生成基础级(Base)物品

根据上面决定的 qlvl 和 ilvl 生成基础级物品。不同的 NPC 所能生成的物品也不同。

4\. 确定物品的成色

若 ilvl\< 25, 则物品有可能不是蓝色(Magic)的, 否则必为蓝色。

5\. 基础级物品的升级和转型

升级和转型仅发生在 Nightmare 和 Hell 难度. 且不同难度下的升级和转型过程并不相同。升级和转型仅在 ilvl\> 25 时发生.

(1) Nightmare 下的升级与转型

生成的基础级物品升级成为扩展级(Exceptional)的几率为:

Excep% = (Ilvl \* 0.064 + 4)%

若未升级成扩展级物品, 则发生转型, 即转变成其它基础级物品. 并非所有物品都能转型。

(2) Hell 下的升级与转型

与 Nightmare 不同, Hell 中先进行转型判断。所有能转型的物品均会发生转型。

不发生转型的物品,其升级成扩展级(Exceptional)和精华级(Elite)的几率分别为：

Excep% = (Ilvl \* 0.128 + 5)%

Elite% = (Ilvl \* 0.016 + 1)%

6\. 对蓝色物品选择词缀

NPC 出售物品遵从前文提到的词缀规则。

### Craft 物品的词缀与等级

首先要决定成品的 ilvl，成品的 ilvl 是由原料的 ilvl（source_ilvl）和制作者的 clvl 共同决定的：ilvl = source_ilvl / 2 + clvl / 2，计算中小数则向下取整。

词缀的选择和魔法/稀有物品的选择规律是一样的，但在词缀的数量上，存在一些差异，主要是由成品的 ilvl 决定的，ilvl 决定了成品上出现词缀数目的最小值，最大值固定为 4：ilvl 在 71\~99 之间时，词缀数目必定是 4 个；ilvl 在 51\~70 之间时，词缀数目为 3\~4 个；ilvl 在 31\~50 之间时，词缀数目为 2\~4 个；ilvl 小于等于 30 时，词缀数为 1\~4 个。

Craft 物品的需求等级有特殊的计算方法，规定：

Affix_Required_Level_Max: 各个词缀的需求等级中的最大者。

Affix_Number: 词缀的数目。

Base_Required_Level: 对应的普通物品的需求等级。

New_Required_Level: 成品的需求等级。

则计算方法为：

New_Required_Level = Affix_Required_Level_Max + 3 \* Affix_Number + 10 若 New_Required_Level\<Base_Required_Level，则 New_Required_Level = Base_Required_Level。

### 赌博获得的物品

赌博时, 每次与 NPC 说话, 供赌博的物品都会被刷新。

供赌博的物品的生成过程如下：

1\. 生成基础级(Base)物品

生成的基础级物品的 qlvl 不高于 Clvl+4。生成的基础级物品的 ilvl 在 Clvl-5 到 Clvl+4 之间随机。

Clvl：赌博者的等级

赌博不会生成除刺客爪子之外的角色专用物品。

2\. 基础级物品升级成扩展级(Exceptional)物品

升级成扩展级的概率为：

Excep% = (1 + (ilvl - Excep_qlvl) \* 0.9)%

其中 Excep_qlvl 为基础级物品对应的扩展级物品的 qlvl。若 ilvl\<Excep_qlvl, 则不会发生升级。

3\. 扩展级物品升级成精华级(Elite)物品

升级成精华级的概率为:

Elite% = (1 + (ilvl - Elite_qlvl) \* 0.33)%

其中 Elite_qlvl 为扩展级物品对应的精华级物品的 qlvl。若 ilvl\<Elite_qlvl, 则不会发生升级。

4\. 物品成色的决定

magic: 89.85%

rare: 10%

set: 0.1%

unique: 0.05%

5\. 对亮金和蓝色物品选择词缀遵从前文词缀规则

6.其他

赌博不会获得白色物品，不会出现无形物品，除了几个天生 eth 的暗金

Mf 值和游戏人数不会对赌博产生影响

不同难度 NPC 赌博效果一样，唯一区别的是装备回收价格

如果赌博物品判定为暗金，但 ilvl 不足，则降格至亮金

### 翻箱子/架子/罐子掉落的物品

游戏中有各种各样的目标（object），包括箱子，尸体，石头，陷阱，金钱等等，他们的物品掉落规则根据他们在 object.txt 中 initFN（initiationFN）和 controlFN 这两个标识的不同而不同。有些 object 看起来可能一样，但是事实上他们是不同的 object，initFN 和 controlFN 标识不同，因而在物品掉落过程中会使用不同的初始值（initiation）和控制函数（control）。而有些外形不同的 object 则可能使用相同的初始值（initiation）和控制函数（control）。在 object.txt 中共有接近 600 种 object，本文不打算将他们一一列出，而是在 initFN 和 controlFN 标识的基础下，简述 object drop 的原理。最后将指出大家所关心的宝箱（sparkly chest，OperateFn=4, InitFN=57）的特殊掉落规则作为例子。武器架和装甲架的掉落情况属于特例,并不包含在 objects 中,在后边会有具体介绍。

#### initFN and controlFN

首先需要了解一下不同的 initFN and controlFN 分别控制的什么 object

initFN：

initfn 2, 其他 initFN 不能处理的 object 都归它处理。

initfn 3, 主要用于处理 chest。

initfn 57, 用于处理 sparkly chest 和 special chest（就是宝箱类，很多箱子都是 special chest，比如 act2 的 Arcane Sanctuary 场景有三个方向是以箱子作为结束的。那些箱子也是由 initfn 57 处理。更多的细节在 object.txt 中查找）

initfn 27, 用于处理 sand maggot lair 中的 goo piles（就是看上去是绿色的，粘粘的）

initfn 28 ，用于地上摆放着的 gold 的生成

controlFN：

operatefn 4, 主要用于处理 chest，包括 sparkly chest 和 special chest。同时也用来处理 ratnest（老鼠窝）, caskets（棺材） in arcane sanctuary, hidden stashes in act 5, tombs, and some dead bodies.

operatefn 1, 用来处理绝大部分的棺材，石馆什么的。caskets, beds and sarcophaguses

operatefn 3, urns（瓮）, rock piles, baskets（篮子） and jars

operatefn 5, barrels（木桶）

operatefn 14, crates（柳条箱）, rogue corpses（rogue 的尸体）, jugs, rock piles, logs（原木）, boulders, stashes, cocoons（茧）, goo piles, dead guards and some more.

operatefn 26, bookshelves（书架）

#### TC 选择

所有的 object 在这里是相同的。

选择的原理：在 TearsureClassEx.txt 中（Ex 是指资料片）有关于箱子的 TC 定义，其命名规则如下：

"Act "+act_number+" "+difficulty_code{"","(N)","(H)"}+" Chest "+area_code{"A","B","C"}

比如 hell 难度下 act3 的 object 有以下三个 TC：Act 3 （H） Chest A，Act 3 （H） Chest B，Act 3 （H） Chest C。

每一 act 都有 A，B，C 三种 TC，系统按照如下规则确定到底该 object 属于 a,b 还是 c：

首先，对于每一 act 系统会选取某一场景，将其 alvl 作为最高值；同时选择另一场景，将其 alvl 作为最低值。

然后，根据最高值和最低值将他们中间的区域 3 等份。

最后，考虑待判定 TC 的 object 所在的场景的 alvl 是属于以上 3 个区间中的那一个。

第一个则为 A，第二个则为 B，第三个则为 C。

至于这些 TC 名称代表了什么，这里作个简单介绍：

1）任何 object 的 TC 都包括 4 pick，即最多掉 4 件物品。把包含 4-picks 的一次 drop 称为对 TC 的一次调用。（这个概念在后面的宝箱的物品掉落规律中要多次用到，为什么有些箱子能掉很多东西，远远大于 4，因为他们在 drop 过程中会多次调用某一 TC）

2）任何 object 的 TC 都包括 nodrop 参数，即每一次 pick 都有可能选择不掉东西。

3）下表列出了地狱难度下，不同 act 的 A，B，C TC 能掉落的最高 rune 和最高 qlvl 的物品。

TC 名称 rune qlvl

Act 1 (H) Chest A 26 63

Act 1 (H) Chest B 26 66

Act 1 (H) Chest C 26 66

Act 2 (H) Chest A 28 69

Act 2 (H) Chest B 28 69

Act 2 (H) Chest C 28 69

Act 3 (H) Chest A 30 72

Act 3 (H) Chest B 30 75

Act 3 (H) Chest C 30 75

Act 4 (H) Chest A 32 78

Act 4 (H) Chest B 32 78

Act 4 (H) Chest C 32 78

Act 5 (H) Chest A 33 84

Act 5 (H) Chest B 33 87

Act 5 (H) Chest C 33 87

普通和噩梦可以到 TearsureClassEx.txt 中查找。

#### object 的物品掉落的一般过程

1）再创建游戏的过程中，地图被创建，同时确定所有的 object 的位置。

2）对于所有合适的 object 检测它是否变为一个陷阱。变为陷阱的几率是(monlvl1/8 + 5) %.其中 monlvl1 是从 levels.txt 中读取，代表普通难度下 D2C 模式该场景的 alvl。如果变为陷阱，则等几率变为 8 种不同陷阱中的任何一个。注意，有些场景的陷阱只能变为 8 种陷阱中的少数几个，如 sand maggot lair。

3）对于所有合适的 chest 检测它上锁的几率。上锁的几率是(monlvl1/2 + 8) % ，其中 monlvl1 同上。未上锁的普通箱子在 drop 过程中只对 TC 进行一次调用，而上锁的箱子会对 TC 进行两次调用。所以上锁的箱子会比不上锁的掉更多的东西

4）按照前面的法则，确定该 object 的 TC。

5）接下来的部分是 object 中最为特殊的部分。

系统中有些 dlls 函数会检测不同 object 的 controlFN ，从而确定一个 X 值，使得该 object 有（100-X）%的几率不掉任何装备，X%的几率按照选定的 TC 进行 drop。

以下是一些 object 的 X 值。

operatefn1, caskets, sarcophagues and beds

始终按照选定 TC 进行 drop。但是有 18.07%的几率生成怪物。

operatefn3, urns, jars, baskets, dead body sewers, rock piles

21%的几率按照选定的几率 drop。

operatefn14, creates, rogue corpses, skull piles, jugs, loose rocks, a bunch of stashes, rat nests, cocoons, various other

bodies, some beds and a bunch of other stuff too

始终按照选定 TC 进行 drop。

operatefn26, bookhelf

35%掉书, 65%掉卷轴. 鉴定和回城的几率是 1：1

operatefn5, barell

21%几率按照选定 TC 进行 drop. 同时 18.07%的几率生成怪物

operatefn4, chest

始终按照选定 TC 进行 drop。

6）mf 及其他

object 掉落的物品成色判断等同于怪物掉落物品的成色判断。但是有时候会有一个特定的品质参数，比如下面要说的 sparkly chest 和 special chest 的 drop 过程。

最后想提醒一下的是，这部分仅仅是 object drop 的一般过程。如前所述，系统会根据 object 的 initFN 和 controlFN 标识的不同而使用 dll 中不同的函数来修正 drop 过程。所以很多 object 的 drop 过程并不是这么简单。其中最为复杂的就是 sparkly chest 和 special chest 的 drop 过程。

#### sparkly chest 的 drop 过程

当一个 sparkly chest 打开时，系统按照不同的概率选择不同的 drop 方案：

方案 1 == 2% chance

方案 2 == 4% chance

方案 3 == 6% chance

方案 4 == 20% chance

方案 5 == 30% chance

方案 6 == 38% chance

##### 方案 1：unique drop

这个方案有特定的品质参数，为 unique。系统会对该箱子的 TC 进行第一次调用，并且强制性将所有掉落的物品设定为暗金的。除去以下 3 种情况；

1）该物品类型没有 unique 形态，则物品降格为 rare 形态，耐久度\*3

2）该物品的 ilvl 不满足 unique 形态的 qlvl 要求，则物品降格为 rare 形态，耐久度\*3

补充说明 object drop 的 ilvl 计算：兵器架上的物品, ilvl = arealvl -1; 其它物品 ilvl = arealvl 。

3）掉落的是 rune，gold 等物品。

系统将检测该次调用所掉落的最后一件物品，如果是暗金的，则本次 drop 结束。该 sparkly chest 不会再掉落任何东西。

但是如果最后一件物品属于以上 3 种情况，则系统会对 TC 进行第二次调用，并且对第二次调用中最后掉落的物品进行 unique 检测。

如果成功，则本次 drop 结束；如果再次失败，则转到方案 6 继续 drop。

##### 方案 2：set drop

和 1 的区别是，该方案的特定品质参数是 set。

系统同样首先进行第一次调用，并强制设定掉落物品为 set 形态。同样会有 3 种例外：

1）该物品无 set 形态，则物品降格为 magic 形态，耐久度\*2

2）ilvl 不满足对应的 set 形态的 qlvl 要求，则物品降格为 magic 形态，耐久度\*2

3）掉落的是 rune，gold 等。

系统同样会检测最后一件物品的品质，如果失败则再次调用，如果再次失败则转到方案 6 继续。

##### 方案 3：rare drop

特定的品质参数是 rare。其他同 1，2

唯一的区别是只有一种例外：即 rune，gold 等不可能为 rare 形态的物品。

同样两次检测失败后转到方案 6 继续。

##### 方案 4：magic drop

这里开始有所不同。

特定的品质参数是 magic。

系统会前后最多进行 10 次调用，并检测每次调用最后掉出物品的品质。

如果检测到有 3 次调用的最后掉落物品是 magic 形态，则停止下次调用，drop 完成。

即使 10 次调用全部失败，也不会转到方案 6 去。

##### 方案 5：magic drop

特定的品质参数还是 magic。

系统会前后最多进行 10 次调用，并检测每次调用最后掉出物品的品质。

如果检测到有 2 次调用的最后掉落物品是 magic 形态，则停止下次调用。而继续掉落（7-\#）堆金钱。\#的数目等于

前面检测失败的调用次数。至此 drop 完成。

即使 10 次调用全部失败，也不会转到方案 6 去。

##### 方案 6：magic drop

首先系统还是前后最多进行 10 次调用并检测每次调用最后掉出物品的品质。这 10 次调用的品质参数是 magic。

如果检测到有 1 次调用的最后掉落物品是 magic 形态，则系统还会调用一次 TC，但是这次的调用是没有品质参数的。同时这次调用

的 pick 次数=（4-\#），其中\#的数目等于前面检测失败的调用次数。在这次调用中，玩家的 mf 值将决定掉落物品的品质。（前面过程中玩家的 mf 值没起作用）。调用结束后，系统再掉落 5 堆 gold, 2 个血瓶和 2 个 mana 瓶.至此 drop 结束。

#### special chest 的掉落

特殊箱子看上去和普通箱子外表没有区别，但通常会掉落更多物品。这样的箱子具有固定的品质。与普通箱子的第一个主要区别是，对于特殊箱子，品质判定完全被跳过，取而代之的是一个随机选择，所有物品都被分配了魔法品质或稀有品质（亮金）。魔法品质的几率为 95%，稀有品质（亮金）的几率为 5%。当然，这仅适用于品质可变的物品，不适用于药水和卷轴。要注意两点：

1）如果一个物品没有稀有品质，则会生成魔法物品。这条适用于所有护身符。

2）这种品质选择独立于掉落，也就是说不和箱子调用一个 TC。特别是那些没有稀有和魔法品质的物品。

未上锁的箱子会执行一次调用，而上锁的箱子执行两次。在调用完成后，检测本次调用中第一个产生的物品是否有魔法及以上品质。如果检测为真，则中止掉落判定，并终止本次掉落。要注意：

1）若在调用中没有物品掉落，则上述检测结果为失败。

2）哪些物品会被判定为魔法以上品质，在各版本中几乎是确定的。比如，1.00-1.06b 版本中，投掷类物品几乎不会被判定成功；在 1.07-1.08 版本中，头环被默认为魔法以上品质。

如果上述魔法品质检测失败，则进入 special chest 掉落的第二部分。将再次进行 10 次调用，在每次调用完成后对产生的第一个物品执行魔法品质测试（第十次调用除外）。如果任何一次测试为真，或者第十次调用完成，将中止剩余的调用（如果有的话），并且本次掉落完成。

#### 武器架和防具架的掉落

武器架和装甲架掉落物品的物品等级,为 Alvl-1(场景等级-1)。

但是它们没有可供选择的 TC。武器架直接在 weapons.txt 中选择。装甲架在 armor.txt 中选取。这时就需要用到掉落等级和物品的 qlvl 等级了。

在 weapons.txt 或 armor.txt 中随机选择 qlvl 小于等于掉落等级的物品,所以,即使是 85 级场景的装备架,也不能掉出全部的装备,因为它只能掉落小于等于 qlvl84 的装备,这里决定的因素是 qlvl,和 TC 并没有关系.唯一能掉全装备的场景是亚瑞特山巅(Alvl=87),但是那里没有装备架\~\~\~

选择过程中，会根据装备的 rarity 值来计算出现几率，rarity 值越高则越难掉落。另外，对 SOR 的专属法球，精华级的次元碎片，判定成功后，还有 1/3 的判定惩罚。也就是说选中次元碎片后，还有 2/3 的失败几率，判定失败后，取而代之掉落的是手斧。而其他角色的专属则没有这个惩罚。

武器架和防具架掉落物品的染色机制尚未查到资料。

## 其他物品学相关知识

前文主要是介绍物品掉落的整个体系，但是有些内容不方便放入，同时物品学还包括着其他和掉落无关的内容，所以统一放在这一章，以作补充。

### 关底 BOSS 的任务杀

关底 BOSS 在任务杀（首杀）时与非任务杀时选取的 TC 是不同的。两者主要有 2 个区别：

1）任务杀的 TC 不含 Junk 类子 TC

即任务杀不会掉落箱子钥匙、卷轴、药水、弹药

注：督瑞尔固定会掉落回城卷轴

2）任务杀的 TC 的 Rare=1024，非任务杀 Rare\<1024，Magic=1024

即任务杀最低成色判定为黄色，不会掉落蓝色、白色物品。非任务杀最低成色判定为蓝色，不会掉落白色物品。

注：当绿色掉落无法发生时（Mlvl 不够、底材无对应绿色形态等原因），将会发生绿色降格为蓝色的情况。这就是任务杀也会出现蓝色的原因，但其出现的蓝色为双倍耐久以示区别。

### 钥匙掉落

地狱难度的女伯爵、召唤者、尼拉塞克将会掉落打 6BOSS 的 3 种钥匙。

钥匙被加入到他们的 TC 中，其余物品的 Prob 值保持不变。因此，实际上 1.11 之后对于地狱难度的这 3 个怪，非钥匙物品的掉率都有微小的下降。

### 【实例】埋骨之地下 2 个墓室的掉落分析

这 2 个互为隔壁的墓室，大陵寝 alvl=85，墓地 alvl=83。这个大陵寝就是我们常挂在嘴边的“85 级场景了”。那么到底 85 级场景有什么特殊的，能掉所有的物品？我们慢慢来计算，算是在开篇做个热身运动。

由此来详细解说一下何谓 85 级场景：

大陵寝的 alvl=85，因此小怪的怪物等级被修正为 mlvl=85，头目怪 mlvl=87，精英怪及其随从 mlvl=88。小怪的 TC 根据 TC 升高原理，一直升到 TC 等级 ≥ mlvl=85 为止。

以骷髅为例，的原 TC 为【Act 1（H）H2H A】，在所在 TC 组 group=7 中，TC 等级 67 \<mlvl，于是把这个 TC 在 group=7 中一直升高，一直升到 TC 等级=85 的【Act 5（H）H2H C】作为其最终实际 TC。

这个 TC 能掉落的装备在子 TC【Act 5（H）Equip C】中，该子 TC 中包含的最高自动 TC 为【weap87】和【armo87】，即可掉落 qlvl≤87 的底材（即所有底材）。其 mlvl=85，也就是能掉落成品 Qlvl≤85 的暗金和绿色装备。

同理可算得，头目、精英怪、随从的最高自动 TC 等阶=87，可掉落所有底材；mlvl=88，可掉落掉落成品 Qlvl≤88 的暗金和绿色装备（也就是除牛魔王外的所有）

项链底材 qlvl=1，“+2 职业技能”词缀等级 Alvl=90。此词缀需要怪物 mlvl≥[90+（1/2）]=90 才会出现。因此此地所有怪掉落的黄色、蓝色项链上都不会出现+2 职业技能属性。

因此在 85 级场景：所有的怪物均可掉全部底材。

精英、头目怪可掉除了牛魔王套装之外所有非任务暗金、绿色物品。

所有的怪物均无法掉落 2 技能项链。

那么隔壁的墓地作为 83 场景又如何呢

小怪 mlvl=83，使用 TC 升高原理得到其最终 TC 提升到 TC 等级 83。还是以骷髅为例，其最终 TC 因此变成【Act 5（H）H2H B】，包含最高的自动 TC 等阶同样是 87。

同理可得，alvl=80 的场景中精英怪和随从怪的 TC 中包含的最高的自动 TC 等阶也达到了 87。因此不要误以为只有达到 85 级的场景才能掉 TC=87 的底材。

但要注意，虽然 80、83、85 级场景中的部分怪物能掉落底材的最高自动 TC 都=87（根据我们平常用的简化 TC 理论都统称这些怪的 TC=87），但其 TC 实际上是完全不同的两个（一个是【Act 5（H）H2H C】一个是【Act 5（H）H2H B】），我们可以看到 85 级场景小怪物掉 TC=87 的底材的几率是 83 场景的小怪（或 80 级场景的随从怪）的 9 倍左右。

关于 MF 时场景等级的选择就说到这里了。我们在选择 MF 地点时，不要盲目迷信 85 级场景。需要关注的是怪物的实际 TC 等级和 TC 结构，更要注重实际 MF 效率即路程和怪物分布、强度等因素。

### 【实例】暴躁外皮的 MF 分析

暴躁外皮，这就是一个几乎完美的 MF 对象。看似是 83 场景，但由于神殿里的小怪都是暴躁外皮的随从，因此和暴躁外皮一起 mlvl 都=86，他们的实际 TC 不比 85 场景的怪差，这些随从还因为怪物类型被强制设定为和暴躁外皮一样而去掉了冰免。最后由于安亚任务红门的利用而使得这个 MF 点变得高效起来:路程极近，怪物分布固定集中。

这个 MF 点也有其缺点：1.怪物较强，适宜于 1PP，但随从们的 NoDrop 率极高 2.暴躁外皮相对于大部分固定精英怪其成色判定修正值更少，所以更不容易掉暗金、绿、黄色物品，因此需要更高的 MF 值支持。

顺带一提暴躁外皮神殿外躺着的怪，这些怪并不是暴躁外皮的随从，因此怪物等级不受其修正。其 TC 等级和 TC 结构都不好：不但掉落质量差还因 NoDrop 高而掉落极少。加上这些怪固定冰免，实在是劣质 MF 对象的典型。幸运的是，这些怪在我们 MF 暴躁外皮的时候是躺下的，根本用不着理睬它们。

### 【实例】高塔中的女伯爵——女伯爵 RuneDrop 原理解析

女伯爵的 TC 十分的独特，使用了 TC 嵌套来提升了一定范围内的符文的掉率。

下面，我们就以地狱难度的女伯爵来解析女伯爵符文掉落的原理：

首先，地狱女伯爵的 TC 为【Countess（H）】，我们可以看到其 Picks= -2，是一个负数。因此这个 TC 的会按照次序和数量来选取子 TC（而非无序和随机地选取）。女伯爵的掉落首先会进入第一个子 TC【Countess Item（H）】中选取，这个子 TC 的 Picks=5，也就是最多能随机出 5 个物品。结束这 5 次随机选取后才会进入第二个子 TC【Countess Rune（H）】中。这个子 TC 的 Picks=3，最多随机出 3 个符文。由于怪物最多掉落 6 个物品，因此若在【Countess Item（H）】中选取的物品数超过 3 个，那么【Countess Rune（H）】中即使随机出 3 个符文也无法全部掉出。总共掉落的物品达到 6 个以后再被判定为掉落的符文都会消失而不掉出。

女伯爵的 TC 中【Countess Item（H）】包含了武器、防具、金币、药水、珠宝等等，符文占的比例很小，但是其中包含的符文 TC=【Rune14】，即最高可掉落 28\#。而另一子 TC【Countess Rune（H）】中仅包含 NoDrops 和【Runes 12】，只掉符文且几率极大，但最高只能掉落 24\#。可见女伯爵掉落 1\#\~24\#的几率比一般的怪物大了很多，而掉落 25\#\~28\#的几率相对很小。

现在回到我们关心的实际 MF 的问题上来。我们上面提到了【Countess Item（H）】掉落数量大于 3 个时就有可能挤掉 1\#\~24\#符文的掉落，那么是不是 Nodrops 越大越好（也就是 PP 越低越好）呢？但是我们又可以看到两个子 TC 都有 Nodrops，减少 Nodrops 对两者掉落符文几率都可能有提升。到底 PP 数高好还是低好，我们只能通过精确的计算来确定了。

设游戏人数为 P，“[ ]”为向下取整

对于女伯爵的子 TC【Countess Item（H）】（以下简称 TC I）：

Nodrops 率 1 = [（11+19+15+3+1）/（1/（19/（19 + 11+19+15+3+1））\^P -1）]/（[ （11+19+15+3+1）/（1/（19/（19 + 11+19+15+3+1））\^P -1）]+ 11+19+15+3+1）= [ 49/（1/ 27.941%\^P -1）]/（[ 49/（1/ 27.941%\^P -1）] + 49）

掉符文的几率为：（1-Nodrops 率 1）\*（3/49）\* （14/（60+4+10+14+28+14））

=（1-Nodrops 率 1）\* 0.659%

因此不掉符文的几率为：1-（1-Nodrops 率 1）\* 0.659%

对于 TC I 的 Nodrops 率变化：

1PP：27.941176471%

2PP：7.547169811%

3PP：2.000000000%

4PP：0

对于女伯爵的的子 TC【Countess Rune（H）】（以下简称 TCR）：

Nodrops 率 2 =[ 15/（1/（5/5+15）\^P -1）]/（ [ 15/（1/（5/5+15）\^P -1）] + 15）= [ 15/（1/ 25%\^P -1）]/（ [ 15/（1/ 25%\^P -1）] + 15）

掉符文的几率为：1-Nodrops 率 2，即不掉符文的几率为= Nodrops 率 2

对于 TC R 的 Nodrops 率变化：

1PP：25.00000000%

2PP：6.25000000%

3PP：0

1.则对于 TC R 来说

掉落 1 个符文的几率 PR1=3C1\*（1-Nodrops 率 2）\*（Nodrops 率 2）\^2 + 5C5\*（1-Nodrops 率 1）\^5 \*（3C2\*（1-Nodrops 率 2）\^2\*（Nodrops 率 2）\^1）+ 5C5\*（1-Nodrops 率 1）\^5 \*（3C3\*（1-Nodrops 率 2）\^3）

掉落 2 个符文的几率 PR2=（1-5C5\*（1-Nodrops 率 1）\^5）\*（3C2\*（1-Nodrops 率 2）\^2\*（Nodrops 率 2）\^1）+ 5C4\*（1-Nodrops 率 1）\^4\*(Nodrops 率 1)\*（3C3\*（1-Nodrops 率 2）\^3）

掉落 3 个符文的几率 PR3=（1-5C5\*（1-Nodrops 率 1）\^5-5C4\*（1-Nodrops 率 1）\^4\*(Nodrops 率 1)\^1）\*（3C3\*（1-Nodrops 率 2）\^3）

因此 TC R 掉落符文个数的期望为 E1=PR1 + 2\*PR2 + 3\*PR3

2.对于 TC I 来说

掉落 1 个符文的几率 `PI1=5C1 *（（1-Nodrops 率 1）* 0.659%）^1 *（1-（1-Nodrops 率 1）* 0.659%）^4`

掉落 2 个符文的几率 `PI1=5C2 *（（1-Nodrops 率 1）* 0.659%）^2 *（1-（1-Nodrops 率 1）* 0.659%）^3`

掉落 3 个符文的几率 `PI1=5C3 *（（1-Nodrops 率 1）* 0.659%）^3 *（1-（1-Nodrops 率 1）* 0.659%）^2`

掉落 4 个符文的几率 `PI1=5C4 *（（1-Nodrops 率 1）* 0.659%）^4 *（1-（1-Nodrops 率 1）* 0.659%）^1`

掉落 5 个符文的几率 `PI1=5C5 *（（1-Nodrops 率 1）* 0.659%）^5`

因此 TC I 掉落符文的期望为 `E2=PT1 + 2*PI2 + 3*PI3 + 4*PI4 + 5*PI5`

带入当前游戏 PP 数，得到数值为：

1PP: E1=1.845201483 E2=0.023755656

2PP: E1=1.360890990 E2=0.030478955

3PP: E1=1.099921590 E2=0.032307692

4PP: E1=1.000000000 E2=0.032967033

再提高 PP 数爆率不再变化

由此可见，随着 PP 数的上升，女伯爵平均每次掉落的符文数量将明显地下降。

现在单看 1\#\~24\#的总爆率：

以 24\#爆率为例：

1PP: 0.315692797086982000%

2PP: 0.245781080424467000%

3PP: 0.211338058625544000%

4PP: 0.192851786075032000%

再提高 PP 数爆率不再变化

其他 1\#\~23\#的爆率变化与之趋势相同，因此，随着 PP 数的上升，女伯爵掉落的 1\#\~24\#符文的几率将明显下降。

现在单看 25\#\~28\#的总爆率：

以 25\#爆率为例：

1PP: 0.002184409061090080%

2PP: 0.002802631109899420%

3PP: 0.002970786978262470%

4PP: 0.003031414548737570%

再提高 PP 数爆率不再变化

其他 25\#\~27\#的爆率变化与之趋势相同，因此，随着 PP 数的上升，女伯爵掉落的 25\#\~28\#符文的几率将明显上升。

随着 PP 数的上升，女伯爵掉落高级符文占有的百分比提升了。但考虑到 25\#\~28\#的掉率比 20\#\~24\#小两个数量级，因此 PP 数上升获得的收益不足以弥补数量的损失，总收益是下降的。

同时，这个掉出几率还不是符文的最终掉落几率。不要忘了在 Rune Drop 前面还有个 Item Drop。暗黑规定每个怪物最多掉落 6 件，所以 Item 掉落减少会提高 Rune 掉率。综合这点来看，低 pp 更适合在女伯爵处刷符文。

### 【实例】奇异的铁匠

噩梦的铁匠的 TC【Smith（N）】中包含 2 个子 TC【Act 1（H）Uitem C】、【Act 1（N）Melee B】，很明显……第一个子 TC 是一个错误。暴雪错误地把地狱铁匠的第一个子 TC 放入了噩梦难度的铁匠 TC 中\~

这使得噩梦的铁匠能掉一部分地狱铁匠才能掉的东西，其能掉落的最高底材 qlvl=66，但由于噩梦铁匠的怪物等级 mlvl=43 并没有出错，因此能掉的暗金、绿色不多。

噩梦铁匠虽有 BUG，但没什么 MF 价值……没便宜可占。

### 【实例】安姐的 MF 分析

安姐有一个著名的 BUG，那就是第一次杀死她后回城与任意 NPC 对话，以后她每次死亡都自动按照任务杀的 TC 来掉落。

既然如此，我们就只考虑她的任务杀掉落。

地狱难度其 Nodop 率为：

1PP: 45.23809524%

2PP: 17.85714286%

3PP: 8.00000000%

4PP: 4.16666667%

5PP: 0

出【扭曲的痛苦精华】的概率为：

每 DROP 每 KILL：

1PP: 2.380952381% 15.473142461%

2PP: 3.571428571% 21.635002382%

3PP: 4.000000000% 22.997635842%

4PP: 4.166666667% 23.291676198%

5PP: 4.347826087% 23.410529186%

#### 安姐的 MF 分析

从 TC 可以看到，安姐掉【Good】类 TC 中的物品是所有关底 BOSS 中最高的之一（和虫叔差不多，远高于其他怪物）。

【Good】类 TC 包含有：珠宝、宝石、符文、项链、戒指、护身符

##### 护身符

地狱安姐的 mlvl=75，也就是说掉落的护身符是 ilvl=75 的

对于超大护身符 Grand Charm（GC），qlvl=1。词缀等级最高的有用词缀是【生命的（Vita）】+45 生命。

Vita 的词缀等级 Affix_lvl=91，因此 GC 的最小 ilvl=[Affix_lvl+qlvl/2]=91，因此安姐掉落的 GC 洗不出 45 生命……无价值

##### 符文

地狱安姐的符文 TC 为【Rune14】，即最高能掉 28\#，掉落范围比较低，但掉率较大。

其在 5PP 时的掉落符文的几率：

28\#：0.007749721%

27\#：0.011624394%

26\#：0.011034557%

25\#：0.016551454%

24\#：0.015650018%

通过对比我们可以知道，5PP 以上地狱安姐掉 25\#\~28\#符文的几率是整个游戏中最高的！

杀一次 BUG 安姐相当于杀了 16 头普通牛掉 28\#的几率，相当于杀 2.6 次女伯爵掉 28\#的几率，但杀一次女伯爵相当于杀 12 次 BUG 安姐掉 24\#的几率。同样地，由于女伯爵掉 24\#几率比安姐掉 28\#大了 2 个数量级，因此计算后会发现，对于掉落符文的综合收益来说，安姐不如女伯爵。

##### 饰品

安姐掉饰品（项链、戒指）的几率是所有怪中最高的之一，这是无疑的。但对于部分暗金饰品，安姐由于其 mlvl 只有 75 而掉不了，包括：大自然的和平、鬼火投射者、马拉的万花筒、金属网格。

但正因为如此，对安姐来说这 4 个饰品的稀有度（rarity）相当于=0，即判定为其他暗金饰品的几率就增加了。

例如：

其他关底 BOSS 掉的暗金戒指判定为乔丹、婚戒的几率为：rarity/ SUM（rarity）=1/(15+15+1+1+10+10+3+1+3)=1/59

安姐掉的暗金戒指判定为乔丹、婚戒的几率为：1/(15+15+1+1+10+10+3)=1/55

判定为乔丹、婚戒的几率增加了(1/55-1/59)/ 1/59 =7.27%

所以地狱安姐不掉大自然、鬼火、马拉、金属网格，但其掉落的暗金饰品被判定为除了这 4 个之外的东西的几率有小幅增加

#### 详细的掉率分步计算

以 450MF3PP 下地狱难度的安达利尔任务杀掉乔丹之石为例：

Nodrop 率=[(19+3+1)/(1/ (19/(19+19+3+1))\^3-1)]/([(19+3+1)/(1/ (19/(19+19+3+1))\^3-1)]+(19+3+1))=8%

掉出率（Drop 率）=1- Nodrop 率=92%

从主 TC 中取 TC【Act 2 (H) Good】的几率=3/(19+3+1)=13.0434783%

从 TC【Act 2 (H) Good】中取 TC【Jewelry C】的几率=60/(60+4+10+14+28+14)=46.1538462%

从 TC【Jewelry C】中取物品【rin】的几率=8/(8+4+2+2+2+2)=40%

因此每个 Drop 掉一个戒指的几率 `P=92% * 13.0434783% * 46.1538462% * 40% = 2.215384615%`

每 Kill 掉一个戒指的几率为=`1 - (1-P)^7 - (1 - Nodrop 率)^6 * (1-P/(1- Nodrop 率))^6 * P = 13.353709044%`

底材掉落完毕，开始成色判定过程：

`暗金基础判定值= (400 - [(75 - 1)/1]) * 128=41278`

MF 值对成色的修正

MF 实际效果计算：

`暗金 = [450 * 250 / (450 + 250)]%=160%`

检查 MF 修正是否溢出

`暗金基础判定值 * 100 / (100 + 160)=16049 > MIN = 6400` ------未超过最小值

因此，MF 修正后的暗金判定值=16049

怪物 TC 对成色的修正

安达利尔任务杀 TC，Unique 值=995

`TC 修正后的暗金判定值= MF 修正后的暗金判定值 - [(MF 修正后的暗金判定值 * 995)/1024] = 455`

最终成色判定几率

戒指被判定为暗金的几率= 128 /(1 + TC 修正后的暗金判定值)=28.0998%

最终物品判定几率

该戒指被判定为乔丹之石的概率=1/(15+15+1+1+10+10+3)=1/55=1.82%

因此，450MF3PP 安姐任务杀掉乔丹之石的几率为：

`每个 Kill 掉一个戒指的几率 * 最终成色判定几率 * 最终物品判定几率 = 13.353709044% * 28.0998% * 1.82% = 0.068224832%`

### 物品耐久的损耗

\#作为攻击方:每次你击中对方,将有 4%的概率损失 1 点武器耐久。

使用投掷类武器近战的话，数量将作为耐久度来损耗。

踢击不会损耗武器的耐久。

smite 做为一种 bug 判定,损耗的是武器的耐久。

\#作为被攻击方:每次被对方击中,首先会有以下判定(具体的原理不明)

头-------甲-------右手------左手-------腰带------鞋子--------手套

服务器会随机挑选出 1 个部位作为受到攻击的判定

可以简单的理解成就那 1 个防具承受了伤害

被攻击方耐久损失判定：

概率因数

头盔：3

装甲：2

左手：2

右手：2

腰带：4

鞋子：4

手套：3

选择左手和右手的话，都体现在盾牌上。

即装备全部防具的话：

头盔：3/20 ＝ 15%

装甲：2/20=10%

左手：2/20=10%

右手：2/20=10%

腰带：4/20=20%

鞋子：4/20=20%

手套：3/20 ＝ 15%

被挑选出的那个防具有 10%的概率损失 1 点耐久

盾牌格挡不会损失耐久，asn 的武器格挡和刀刃之盾会损耗武器的耐久。

非肉搏伤害不会损失耐久，如魔法伤害

注:左右手是假设拿盾的情况，拿双手武器的可以不经过手的判定

又如身上只有衣服的话，直接判定就挑选出衣服做承受方

### Magical 和 Rare 物品外观颜色的显示

暗黑里的装备种类繁多,装备的颜色也各不相同，多姿多彩。下面就来介绍一下装备的颜色问题。

装备颜色的显示原则是:装备的颜色只能显示一种，如果有多个词缀都带颜色的话，按照以下规则显示颜色。

1. 前后缀都有颜色，后缀优先。

2. 两个或者三个前缀都有颜色，按照顺序优先。后缀同理。

这里的所谓顺序是在物品存档中的排列顺序，六个词缀以 Prefix 1、Suffix 1、Prefix 2、Suffix 2、Prefix 3、Suffix 3 的顺序排列。

以上，概括来说就是，词缀颜色显示的顺序是 `Suffix 1>Suffix 2>Suffix 3>Prefix 1>Prefix 2>Prefix 3`

另外，角色专用装备 Orb 类上出现的 Autoaffix,有些也可以使装备变色，因此对于 Orb 类词缀颜色显示的顺序是

`Suffix 1>Suffix 2>Suffix 3>Prefix 1>Prefix 2>Prefix 3>Autoaffix`

限于篇幅，就不列出能改变物品颜色的所有词缀，需要的可以自行查询。

### 亮金物品的命名规则

亮金物品的名称同词缀无关，当物品生成时系统会从事先亮金名称列表中按物品类型随机选取一个名称前缀和一个名称后缀组合在一起。具体的亮金名称前缀后缀请自行查询。

### CTC mod

很多装备上都有 CTC：Chance To Cast 的 mod。

一般分两类，一类是以词缀的方式出现在魔法物品上，一类是固定出现在特定的暗金物品上，比如彩虹刻面暗金珠。

CTC mod 有不同的技能(Skill)，技能级别(Slvl)，和触发条件(trigger)。

一般 CTC 技能的 trigger 有 on striking，on attack，when struck 等。

特别的，暗金珠宝和一些符文之语中还有 when level up 和 when die 这两种触发条件。

1.CTC 的触发几率：

对于 Skill，Slvl 和 trigger 都相同的不同装备上的 CTC，触发几率为各装备之和(双手武器除外)。如果和大于 100，则取 100。若 skill，slvl 和 trigger 中有一个不同，则分别独立地判定是否触发各个不同的 CTC mod。

双手武器：Bar 或 Asn 持双手武器时，触发几率为当前攻击所用武器上的 CTC 与其他非武器装备之和，另一把武器不参与计算。

若持双手武器使用 Cast Spell 类技能，则 CTC 几率只计算主手武器，副手武器不参与计算。

2.CTC 的加成

1)技能加成

CTC mod 上的技能会受到人物本身的相关技能的加成。

如 unique jew 上的 meteor(陨石)将受到 sor 本身的 fire bolt，

fire ball 和 fire mastery 的加成，但是与 sor 本身的 meteor 无关。

2)装备加成

CTC mod 上的技能会受到人物装备上相关的+% dam 和-% res 的影响。

但是+ all skill 不影响 CTC 的 Slvl，只能通过影响相应的 mastery 来增强伤害

3)charge 加成

CTC mod 在一定条件下会受到人物装备上 charge skill(聚气技能)的加成。

条件同 charge bug 的出现条件。

4)CTC 加成

一件物品上的 CTC mod 不会受到另一物品上 CTC skill 的加成。

### 防具的防御计算流程

1 在防具基础 def 中随机选取(drop 时决定)

2 如果该防具有%ed 属性,在计算时将基础防御代为 max_basedef+1. (有+ED 的，在辨识之前就修正+1 了)

3 无形检测,加 50%ed(ethereal),有小数向下取整.

4 计算%ed，有小数向下取整

5 计算"+def"

升级时的计算过程跳过第 2 步.

在 1.10 版本同时会跳过第 3 步计算.(1.10bug)

注：1.11 版本已经修正此 bug.

举例说明一下此问题：

1.无 ed 的神圣盔甲，防御值在掉落时是随机选取，神圣盔甲的基础防御值是 487--600 之间，即防御值可能为 487--600 之间的任意一个数值。

2.有 ED 属性的神圣盔甲，防御值计算公式为`（600+1）*（1+ed%）`，注：最终数值有小数向下取整。

3.无形的有 ed 的神圣盔甲，防御值计算公式为`（600+1）*（1+50%）*（1+ed%）`，注：每做一次乘法就向下取整一次，而不是最终的结果一次性向下取整。

4.举例说明一下这句话“升级时跳过第 2 步.[跳过第 3 步计算.(1.10bug,1.11 已修复)]”

比如我们要升级无形的吸血鬼凝视残酷头盔，升级后成为骸骨面罩,其基础防御值为 100 到 157。

（1）升级时选取随机防御值，比如 120；

（2）因为物品自身具有+%ED 属性所以将计算所需值设为最大基础防御值+1=157+1=158（跳过）

（3）无形状态，则+50%ED: 158 x (1+50%)=237（1.10 中跳过,1.11 已修复）

（4）+100%ED: 120 x (1+100%)=240,而实际上应该是 `120 * 1.5 * (1+100%) = 360`

（5）+x Defense: Gaze 没这个属性。

所以经过升级后的无形吸血鬼凝视残酷头盔的防御值本该为 300\~470，结果却成了在 200 到 314 之间变化的随机数值，比如这里计算得到的 240。

### ed/max（min） bug

```
伤害计算公式：最终伤害=（（基本伤害 x1.5{只作用于无形物品}）（1+武器 ed 数值/100）+直接最小/最大伤害增加值）（1+力量或敏捷/100+非武器 ed 数值/100+技能 ed 数值%/100））（1-技能伤害惩罚/100）x2{只在临界一击或者致命一击发生作用时}+元素伤害
```

结论：ed/max,ed/min jew 镶在 non-weapon item 上，会忽略掉镶入的 ed%对于总伤害 max/min 的作用。

换而言之，在用以上公式分别计算最终 max／min 的时候，镶入的 ed％部分不参与公式计算。

更进一步的结论：

如果在多孔的 non-weapon item 上,先镶入 ed%,再镶入 min(或 max),获得正常的效果。

如果先镶入 min(或 max),再镶入 ed%,则 bug 会产生,忽略掉 ed%对 min(或 max)的加成。

如果 non-weapon item 上,已经有了 min(或 max)的属性,镶入 ed%的话,情况同先镶入 min(或 max) jew。

如果 non-weapon item 上,已经有了 ed%属性,镶入 min(或 max)，获得正常的效果。

一件装备上的＋ min／max，不会影响到后穿上的另一件装备上的 ed％．

Eg：

依次镶入 40ed%，15max，30ed% 3 颗 jew，效果为 70ed% to min， 40%ed to (max+15max)

ed/max,ed/min 的 bug 在于系统会首先检查 min(或 max)，然后再检查 ed%
